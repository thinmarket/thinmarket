<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–ê–Ω–∞–ª–∏–∑–∞—Ç–æ—Ä –õ–∏–∫–≤–∏–¥–Ω–æ—Å—Ç–∏ –û–ø—Ü–∏–æ–Ω–æ–≤ - –û–±—ä–µ–º—ã –∏ –ê–∫—Ç–∏–≤–Ω–æ—Å—Ç—å</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 1600px;
            margin: 0 auto;
            padding: 20px;
            background-color: #232323;
            color: #fff;
        }
        .container {
            background: #2E2E2E;
            padding: 25px;
            border-radius: 15px;
            box-shadow: 0 4px 20px rgba(0,0,0,0.18);
            margin-bottom: 25px;
        }
        h1 {
            color: #4CAF50;
            text-align: center;
            margin-bottom: 30px;
            font-size: 28px;
        }
        h2, h3 {
            color: #fff;
        }
        .filters {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 25px;
        }
        .input-group {
            margin-bottom: 15px;
        }
        label {
            display: block;
            margin-bottom: 8px;
            font-weight: bold;
            color: #4CAF50;
            font-size: 16px;
        }
        input, select {
            width: 100%;
            padding: 12px;
            border: 2px solid #444;
            border-radius: 8px;
            font-size: 16px;
            background: #181818;
            color: #fff;
            box-sizing: border-box;
        }
        input:focus, select:focus {
            border-color: #4CAF50;
            outline: none;
        }
        button {
            background: linear-gradient(135deg, #4CAF50, #2980b9);
            color: white;
            padding: 15px 25px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-size: 16px;
            margin: 8px;
            font-weight: bold;
            transition: transform 0.2s, background 0.2s;
        }
        button:hover {
            transform: translateY(-2px);
            background: linear-gradient(135deg, #2980b9, #4CAF50);
        }
        .results-container {
            margin-top: 25px;
        }
        .liquidity-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }
        .liquidity-card {
            background: #232323;
            padding: 20px;
            border-radius: 12px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.18);
            border-left: 6px solid #3498db;
        }
        .liquidity-card.high {
            border-left-color: #27ae60;
            background: linear-gradient(135deg, #1b2e1b, #232323);
        }
        .liquidity-card.medium {
            border-left-color: #f39c12;
            background: linear-gradient(135deg, #2e2a1b, #232323);
        }
        .liquidity-card.low {
            border-left-color: #e74c3c;
            background: linear-gradient(135deg, #2e1b1b, #232323);
        }
        .liquidity-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }
        .option-title {
            font-size: 18px;
            font-weight: bold;
            color: #fff;
        }
        .liquidity-score {
            background: #181818;
            padding: 8px 15px;
            border-radius: 20px;
            font-weight: bold;
            font-size: 16px;
        }
        .score-high { color: #27ae60; }
        .score-medium { color: #f39c12; }
        .score-low { color: #e74c3c; }
        .volume-details {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
            gap: 10px;
            margin-bottom: 15px;
        }
        .volume-item {
            text-align: center;
            padding: 10px;
            background: #181818;
            border-radius: 8px;
        }
        .volume-value {
            font-size: 16px;
            font-weight: bold;
            color: #fff;
        }
        .volume-label {
            font-size: 12px;
            color: #7f8c8d;
            margin-top: 5px;
        }
        .liquidity-status {
            font-weight: bold;
            font-size: 14px;
            margin-top: 10px;
            padding: 8px;
            border-radius: 6px;
            text-align: center;
        }
        .status-high {
            background: #1b2e1b;
            color: #27ae60;
        }
        .status-medium {
            background: #2e2a1b;
            color: #f39c12;
        }
        .status-low {
            background: #2e1b1b;
            color: #e74c3c;
        }
        .stats-bar {
            background: #181818;
            padding: 15px;
            border-radius: 10px;
            margin: 20px 0;
            text-align: center;
            color: #fff;
        }
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 15px;
            margin-top: 15px;
        }
        .stat-item {
            background: #232323;
            padding: 15px;
            border-radius: 8px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.10);
        }
        .stat-value {
            font-size: 24px;
            font-weight: bold;
            color: #fff;
        }
        .stat-label {
            font-size: 14px;
            color: #7f8c8d;
            margin-top: 5px;
        }
        .loading {
            text-align: center;
            padding: 40px;
            font-size: 18px;
            color: #4CAF50;
        }
        .spinner {
            border: 4px solid #333;
            border-top: 4px solid #4CAF50;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
            margin: 0 auto 20px;
        }
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        .warning-box {
            background: #2e1b1b;
            border: 1px solid #e74c3c;
            border-radius: 8px;
            padding: 15px;
            margin: 20px 0;
            color: #e74c3c;
        }
        .info-box {
            background: #1b2e1b;
            border: 1px solid #27ae60;
            border-radius: 8px;
            padding: 15px;
            margin: 20px 0;
            color: #27ae60;
        }
    </style>
</head>
<body>
    <h1>üìä –ê–Ω–∞–ª–∏–∑–∞—Ç–æ—Ä –õ–∏–∫–≤–∏–¥–Ω–æ—Å—Ç–∏ –û–ø—Ü–∏–æ–Ω–æ–≤ - –û–±—ä–µ–º—ã –∏ –ê–∫—Ç–∏–≤–Ω–æ—Å—Ç—å</h1>
    
    <div class="container">
        <h2>üéØ –ù–∞—Å—Ç—Ä–æ–π–∫–∏ –∞–Ω–∞–ª–∏–∑–∞ –ª–∏–∫–≤–∏–¥–Ω–æ—Å—Ç–∏</h2>
        
        <div class="filters">
            <div class="input-group">
                <label for="assetCode">–ö–æ–¥ –±–∞–∑–æ–≤–æ–≥–æ –∞–∫—Ç–∏–≤–∞:</label>
                <input type="text" id="assetCode" value="CNY" placeholder="–ù–∞–ø—Ä–∏–º–µ—Ä: CNY, SI, SBER">
            </div>
            
            <div class="input-group">
                <label for="optionType">–¢–∏–ø –æ–ø—Ü–∏–æ–Ω–∞:</label>
                <select id="optionType">
                    <option value="call">CALL (–ö–æ–ª–ª)</option>
                    <option value="put">PUT (–ü—É—Ç)</option>
                </select>
            </div>
            
            <div class="input-group">
                <label for="minDays">–ú–∏–Ω–∏–º–∞–ª—å–Ω–æ–µ –≤—Ä–µ–º—è –¥–æ —ç–∫—Å–ø–∏—Ä–∞—Ü–∏–∏ (–¥–Ω–µ–π):</label>
                <input type="number" id="minDays" value="7" min="0" placeholder="–§–∏–ª—å—Ç—Ä –ø–æ –≤—Ä–µ–º–µ–Ω–∏">
            </div>
        </div>
        
        <button onclick="analyzeLiquidity()">üîç –ê–Ω–∞–ª–∏–∑–∏—Ä–æ–≤–∞—Ç—å –ª–∏–∫–≤–∏–¥–Ω–æ—Å—Ç—å</button>
        
        <div class="warning-box">
            <strong>‚ö†Ô∏è –í–∞–∂–Ω–æ:</strong> –ê–Ω–∞–ª–∏–∑ –æ—Å–Ω–æ–≤–∞–Ω –Ω–∞ —Ç–µ–æ—Ä–µ—Ç–∏—á–µ—Å–∫–∏—Ö –ø–∞—Ä–∞–º–µ—Ç—Ä–∞—Ö (–≤—Ä–µ–º—è –¥–æ —ç–∫—Å–ø–∏—Ä–∞—Ü–∏–∏, –≤–æ–ª–∞—Ç–∏–ª—å–Ω–æ—Å—Ç—å, —Ü–µ–Ω–∞, –≥—Ä–µ–∫–∏). 
            –†–µ–∞–ª—å–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ –æ–± –æ–±—ä–µ–º–∞—Ö —Ç–æ—Ä–≥–æ–≤ –∏ —Å–ø—Ä–µ–¥–∞—Ö –ù–ï –¥–æ—Å—Ç—É–ø–Ω—ã —á–µ—Ä–µ–∑ MOEX API. 
            –í—Å–µ–≥–¥–∞ –ø—Ä–æ–≤–µ—Ä—è–π—Ç–µ –∞–∫—Ç—É–∞–ª—å–Ω—É—é –ª–∏–∫–≤–∏–¥–Ω–æ—Å—Ç—å –≤ —Ç–æ—Ä–≥–æ–≤–æ–º —Ç–µ—Ä–º–∏–Ω–∞–ª–µ!
        </div>
        
        <div id="stats" class="stats-bar" style="display: none;"></div>
        <div id="results" class="results-container" style="display: none;"></div>
    </div>

    <script>
        let allLiquidityData = [];

        // –í—Å–ø–æ–º–æ–≥–∞—Ç–µ–ª—å–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è –¥–ª—è –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è —Ç–∏–ø–∞ –æ–ø—Ü–∏–æ–Ω–∞
        function getOptionType(data) {
            if (data.option_type) {
                return data.option_type.toLowerCase();
            }
            const secid = data.secid || data;
            const lastBIndex = secid.lastIndexOf('B');
            const lastUIndex = secid.lastIndexOf('U');
            return lastBIndex > lastUIndex ? 'call' : 'put';
        }

        async function makeRequest(url) {
            try {
                const response = await fetch(url);
                const data = await response.json();
                return { status: response.status, data: data };
            } catch (error) {
                return { status: 'ERROR', data: { error: error.message } };
            }
        }

        function calculateLiquidityScore(data) {
            // –ê–Ω–∞–ª–∏–∑–∏—Ä—É–µ–º –¥–æ—Å—Ç—É–ø–Ω—ã–µ –ø–æ–∫–∞–∑–∞—Ç–µ–ª–∏ –ª–∏–∫–≤–∏–¥–Ω–æ—Å—Ç–∏
            let score = 0;
            let reasons = [];
            
            // –í—Ä–µ–º—è –¥–æ —ç–∫—Å–ø–∏—Ä–∞—Ü–∏–∏ (—á–µ–º –±–æ–ª—å—à–µ –≤—Ä–µ–º–µ–Ω–∏, —Ç–µ–º –ª—É—á—à–µ –ª–∏–∫–≤–∏–¥–Ω–æ—Å—Ç—å)
            const daysToExpiry = data.days_until_expiring || 0;
            if (daysToExpiry > 60) {
                score += 30;
                reasons.push("‚úÖ –ú–Ω–æ–≥–æ –≤—Ä–µ–º–µ–Ω–∏ –¥–æ —ç–∫—Å–ø–∏—Ä–∞—Ü–∏–∏ - –≤—ã—Å–æ–∫–∞—è –ª–∏–∫–≤–∏–¥–Ω–æ—Å—Ç—å");
            } else if (daysToExpiry > 30) {
                score += 25;
                reasons.push("‚úÖ –î–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –≤—Ä–µ–º–µ–Ω–∏ –¥–æ —ç–∫—Å–ø–∏—Ä–∞—Ü–∏–∏");
            } else if (daysToExpiry > 14) {
                score += 15;
                reasons.push("‚úÖ –£–º–µ—Ä–µ–Ω–Ω–æ–µ –≤—Ä–µ–º—è –¥–æ —ç–∫—Å–ø–∏—Ä–∞—Ü–∏–∏");
            } else if (daysToExpiry > 7) {
                score += 5;
                reasons.push("‚ö†Ô∏è –ú–∞–ª–æ –≤—Ä–µ–º–µ–Ω–∏ –¥–æ —ç–∫—Å–ø–∏—Ä–∞—Ü–∏–∏");
            } else {
                score -= 20;
                reasons.push("‚ùå –û—á–µ–Ω—å –º–∞–ª–æ –≤—Ä–µ–º–µ–Ω–∏ –¥–æ —ç–∫—Å–ø–∏—Ä–∞—Ü–∏–∏ - –Ω–∏–∑–∫–∞—è –ª–∏–∫–≤–∏–¥–Ω–æ—Å—Ç—å");
            }
            
            // –í–æ–ª–∞—Ç–∏–ª—å–Ω–æ—Å—Ç—å (—É–º–µ—Ä–µ–Ω–Ω–∞—è –≤–æ–ª–∞—Ç–∏–ª—å–Ω–æ—Å—Ç—å –ª—É—á—à–µ –¥–ª—è –ª–∏–∫–≤–∏–¥–Ω–æ—Å—Ç–∏)
            const volatility = data.volatility || 0;
            if (volatility > 0 && volatility < 30) {
                score += 25;
                reasons.push("‚úÖ –ù–∏–∑–∫–∞—è –≤–æ–ª–∞—Ç–∏–ª—å–Ω–æ—Å—Ç—å - —Å—Ç–∞–±–∏–ª—å–Ω–∞—è –ª–∏–∫–≤–∏–¥–Ω–æ—Å—Ç—å");
            } else if (volatility >= 30 && volatility < 50) {
                score += 20;
                reasons.push("‚úÖ –£–º–µ—Ä–µ–Ω–Ω–∞—è –≤–æ–ª–∞—Ç–∏–ª—å–Ω–æ—Å—Ç—å - —Ö–æ—Ä–æ—à–∞—è –ª–∏–∫–≤–∏–¥–Ω–æ—Å—Ç—å");
            } else if (volatility >= 50 && volatility < 70) {
                score += 10;
                reasons.push("‚ö†Ô∏è –í—ã—Å–æ–∫–∞—è –≤–æ–ª–∞—Ç–∏–ª—å–Ω–æ—Å—Ç—å - –≤–æ–∑–º–æ–∂–Ω—ã –ø—Ä–æ–±–ª–µ–º—ã");
            } else {
                score -= 15;
                reasons.push("‚ùå –û—á–µ–Ω—å –≤—ã—Å–æ–∫–∞—è –≤–æ–ª–∞—Ç–∏–ª—å–Ω–æ—Å—Ç—å - —Ä–∏—Å–∫ –Ω–µ–ª–∏–∫–≤–∏–¥–Ω–æ—Å—Ç–∏");
            }
            
            // –¢–µ–æ—Ä–µ—Ç–∏—á–µ—Å–∫–∞—è —Ü–µ–Ω–∞ (–¥–µ—à–µ–≤—ã–µ –æ–ø—Ü–∏–æ–Ω—ã –æ–±—ã—á–Ω–æ –±–æ–ª–µ–µ –ª–∏–∫–≤–∏–¥–Ω—ã)
            const theorPrice = data.theorprice || 0;
            const underlyingPrice = data.underlying_price || 1;
            const priceRatio = theorPrice / underlyingPrice;
            
            if (priceRatio < 0.02) {
                score += 20;
                reasons.push("‚úÖ –û—á–µ–Ω—å –¥–µ—à–µ–≤—ã–π –æ–ø—Ü–∏–æ–Ω - –≤—ã—Å–æ–∫–∞—è –ª–∏–∫–≤–∏–¥–Ω–æ—Å—Ç—å");
            } else if (priceRatio < 0.05) {
                score += 15;
                reasons.push("‚úÖ –î–µ—à–µ–≤—ã–π –æ–ø—Ü–∏–æ–Ω - —Ö–æ—Ä–æ—à–∞—è –ª–∏–∫–≤–∏–¥–Ω–æ—Å—Ç—å");
            } else if (priceRatio < 0.1) {
                score += 10;
                reasons.push("‚úÖ –£–º–µ—Ä–µ–Ω–Ω–∞—è —Ü–µ–Ω–∞ - —Å—Ä–µ–¥–Ω—è—è –ª–∏–∫–≤–∏–¥–Ω–æ—Å—Ç—å");
            } else if (priceRatio < 0.2) {
                score += 5;
                reasons.push("‚ö†Ô∏è –î–æ—Ä–æ–≥–æ–π –æ–ø—Ü–∏–æ–Ω - –≤–æ–∑–º–æ–∂–Ω—ã –ø—Ä–æ–±–ª–µ–º—ã");
            } else {
                score -= 10;
                reasons.push("‚ùå –û—á–µ–Ω—å –¥–æ—Ä–æ–≥–æ–π –æ–ø—Ü–∏–æ–Ω - –Ω–∏–∑–∫–∞—è –ª–∏–∫–≤–∏–¥–Ω–æ—Å—Ç—å");
            }
            
            // Delta (–æ–ø—Ü–∏–æ–Ω—ã —Å delta –±–ª–∏–∂–µ –∫ 0.5 –æ–±—ã—á–Ω–æ –±–æ–ª–µ–µ –ª–∏–∫–≤–∏–¥–Ω—ã)
            const delta = Math.abs(data.delta || 0);
            if (delta > 0.3 && delta < 0.7) {
                score += 15;
                reasons.push("‚úÖ –û–ø—Ç–∏–º–∞–ª—å–Ω–∞—è Delta - –≤—ã—Å–æ–∫–∞—è –ª–∏–∫–≤–∏–¥–Ω–æ—Å—Ç—å");
            } else if (delta > 0.1 && delta < 0.9) {
                score += 10;
                reasons.push("‚úÖ –•–æ—Ä–æ—à–∞—è Delta - —É–º–µ—Ä–µ–Ω–Ω–∞—è –ª–∏–∫–≤–∏–¥–Ω–æ—Å—Ç—å");
            } else {
                score -= 5;
                reasons.push("‚ö†Ô∏è –≠–∫—Å—Ç—Ä–µ–º–∞–ª—å–Ω–∞—è Delta - –≤–æ–∑–º–æ–∂–Ω—ã –ø—Ä–æ–±–ª–µ–º—ã");
            }
            
            // –ö–æ–º–∏—Å—Å–∏—è (–Ω–∏–∑–∫–∞—è –∫–æ–º–∏—Å—Å–∏—è = –ª—É—á—à–µ –ª–∏–∫–≤–∏–¥–Ω–æ—Å—Ç—å)
            const fee = data.fee || 0;
            if (fee < 0.5) {
                score += 10;
                reasons.push("‚úÖ –ù–∏–∑–∫–∞—è –∫–æ–º–∏—Å—Å–∏—è - —Ö–æ—Ä–æ—à–∞—è –ª–∏–∫–≤–∏–¥–Ω–æ—Å—Ç—å");
            } else if (fee < 1.0) {
                score += 5;
                reasons.push("‚úÖ –£–º–µ—Ä–µ–Ω–Ω–∞—è –∫–æ–º–∏—Å—Å–∏—è");
            } else {
                score -= 5;
                reasons.push("‚ö†Ô∏è –í—ã—Å–æ–∫–∞—è –∫–æ–º–∏—Å—Å–∏—è - –º–æ–∂–µ—Ç —Å–Ω–∏–∂–∞—Ç—å –ª–∏–∫–≤–∏–¥–Ω–æ—Å—Ç—å");
            }
            
            return { 
                score: Math.max(0, Math.min(100, score)), 
                reasons,
                volume: 0, // –ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö –æ–± –æ–±—ä–µ–º–µ
                trades: 0, // –ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö –æ —Å–¥–µ–ª–∫–∞—Ö
                spread: null, // –ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö –æ —Å–ø—Ä–µ–¥–µ
                bid: 0,
                ask: 0,
                daysToExpiry: daysToExpiry,
                volatility: volatility,
                priceRatio: priceRatio,
                delta: delta,
                fee: fee
            };
        }

        function getLiquidityStatus(score) {
            if (score >= 70) {
                return {
                    class: 'high',
                    status: '–í–´–°–û–ö–ê–Ø –õ–ò–ö–í–ò–î–ù–û–°–¢–¨',
                    description: '–û–ø—Ü–∏–æ–Ω –∞–∫—Ç–∏–≤–Ω–æ —Ç–æ—Ä–≥—É–µ—Ç—Å—è, —É–∑–∫–∏–π —Å–ø—Ä–µ–¥, –º–Ω–æ–≥–æ —Å–¥–µ–ª–æ–∫'
                };
            } else if (score >= 40) {
                return {
                    class: 'medium',
                    status: '–°–†–ï–î–ù–Ø–Ø –õ–ò–ö–í–ò–î–ù–û–°–¢–¨',
                    description: '–£–º–µ—Ä–µ–Ω–Ω–∞—è –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç—å, –≤–æ–∑–º–æ–∂–Ω—ã –ø—Ä–æ–±–ª–µ–º—ã —Å –∏—Å–ø–æ–ª–Ω–µ–Ω–∏–µ–º'
                };
            } else {
                return {
                    class: 'low',
                    status: '–ù–ò–ó–ö–ê–Ø –õ–ò–ö–í–ò–î–ù–û–°–¢–¨',
                    description: '–ú–∞–ª–æ —Å–¥–µ–ª–æ–∫, —à–∏—Ä–æ–∫–∏–π —Å–ø—Ä–µ–¥, —Ä–∏—Å–∫ –Ω–µ–∏—Å–ø–æ–ª–Ω–µ–Ω–∏—è'
                };
            }
        }

        async function analyzeLiquidity() {
            const assetCode = document.getElementById('assetCode').value.trim();
            const optionType = document.getElementById('optionType').value;
            const minDays = parseInt(document.getElementById('minDays').value) || 0;
            
            if (!assetCode) {
                alert('–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –≤–≤–µ–¥–∏—Ç–µ –∫–æ–¥ –±–∞–∑–æ–≤–æ–≥–æ –∞–∫—Ç–∏–≤–∞');
                return;
            }
            
            // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –∑–∞–≥—Ä—É–∑–∫—É
            document.getElementById('results').innerHTML = `
                <div class="loading">
                    <div class="spinner"></div>
                    –ê–Ω–∞–ª–∏–∑–∏—Ä—É–µ–º –ª–∏–∫–≤–∏–¥–Ω–æ—Å—Ç—å –æ–ø—Ü–∏–æ–Ω–æ–≤ –Ω–∞ ${assetCode}...
                </div>
            `;
            document.getElementById('results').style.display = 'block';
            document.getElementById('stats').style.display = 'none';
            
            // –ü–æ–ª—É—á–∞–µ–º —Å–ø–∏—Å–æ–∫ –≤—Å–µ—Ö –æ–ø—Ü–∏–æ–Ω–æ–≤
            const optionsUrl = `https://iss.moex.com/iss/apps/option-calc/v1/assets/${assetCode}/options`;
            const optionsResult = await makeRequest(optionsUrl);
            
            if (optionsResult.status !== 200) {
                document.getElementById('results').innerHTML = `
                    <h3>‚ùå –û—à–∏–±–∫–∞ –ø–æ–ª—É—á–µ–Ω–∏—è —Å–ø–∏—Å–∫–∞ –æ–ø—Ü–∏–æ–Ω–æ–≤</h3>
                    <p>–°—Ç–∞—Ç—É—Å: ${optionsResult.status}</p>
                    <p>–û—à–∏–±–∫–∞: ${optionsResult.data.error || '–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–∞—è –æ—à–∏–±–∫–∞'}</p>
                `;
                return;
            }
            
            // –§–∏–ª—å—Ç—Ä—É–µ–º –æ–ø—Ü–∏–æ–Ω—ã –ø–æ —Ç–∏–ø—É
            const filteredOptions = optionsResult.data.filter(option => {
                const optionTypeFromAPI = option.option_type ? option.option_type.toLowerCase() : null;
                
                if (optionTypeFromAPI) {
                    return optionTypeFromAPI === optionType;
                } else {
                    const optionTypeFromSecid = getOptionType(option.secid);
                    return optionTypeFromSecid === optionType;
                }
            });
            
            console.log(`–ù–∞–π–¥–µ–Ω–æ ${filteredOptions.length} ${optionType.toUpperCase()} –æ–ø—Ü–∏–æ–Ω–æ–≤`);
            
            // –ê–Ω–∞–ª–∏–∑–∏—Ä—É–µ–º –ª–∏–∫–≤–∏–¥–Ω–æ—Å—Ç—å –∫–∞–∂–¥–æ–≥–æ –æ–ø—Ü–∏–æ–Ω–∞
            allLiquidityData = [];
            let processedCount = 0;
            
            for (const option of filteredOptions) {
                const detailUrl = `https://iss.moex.com/iss/apps/option-calc/v1/assets/${assetCode}/options/${option.secid}`;
                const detailResult = await makeRequest(detailUrl);
                
                if (detailResult.status === 200) {
                    const liquidityAnalysis = calculateLiquidityScore(detailResult.data);
                    const liquidityStatus = getLiquidityStatus(liquidityAnalysis.score);
                    
                    // –§–∏–ª—å—Ç—Ä—É–µ–º –ø–æ –º–∏–Ω–∏–º–∞–ª—å–Ω–æ–º—É –≤—Ä–µ–º–µ–Ω–∏ –¥–æ —ç–∫—Å–ø–∏—Ä–∞—Ü–∏–∏
                    if (liquidityAnalysis.daysToExpiry >= minDays) {
                        allLiquidityData.push({
                            ...detailResult.data,
                            liquidity: liquidityAnalysis,
                            status: liquidityStatus
                        });
                    }
                }
                
                processedCount++;
                // –û–±–Ω–æ–≤–ª—è–µ–º –ø—Ä–æ–≥—Ä–µ—Å—Å
                if (processedCount % 10 === 0) {
                    document.getElementById('results').innerHTML = `
                        <div class="loading">
                            <div class="spinner"></div>
                            –û–±—Ä–∞–±–æ—Ç–∞–Ω–æ ${processedCount} –∏–∑ ${filteredOptions.length} –æ–ø—Ü–∏–æ–Ω–æ–≤...
                        </div>
                    `;
                }
            }
            
            // –°–æ—Ä—Ç–∏—Ä—É–µ–º –ø–æ –ª–∏–∫–≤–∏–¥–Ω–æ—Å—Ç–∏ (–≤—ã—Å–æ–∫–∞—è –ª–∏–∫–≤–∏–¥–Ω–æ—Å—Ç—å –ø–µ—Ä–≤–∞—è)
            allLiquidityData.sort((a, b) => b.liquidity.score - a.liquidity.score);
            
            displayLiquidityResults();
        }

        function displayLiquidityResults() {
            const assetCode = document.getElementById('assetCode').value.trim();
            const optionType = document.getElementById('optionType').value;
            const minDays = parseInt(document.getElementById('minDays').value) || 0;
            
            // –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞
            const totalOptions = allLiquidityData.length;
            const highLiquidity = allLiquidityData.filter(o => o.liquidity.score >= 70).length;
            const mediumLiquidity = allLiquidityData.filter(o => o.liquidity.score >= 40 && o.liquidity.score < 70).length;
            const lowLiquidity = allLiquidityData.filter(o => o.liquidity.score < 40).length;
            
            let statsHtml = `
                <h3>üìä –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ª–∏–∫–≤–∏–¥–Ω–æ—Å—Ç–∏</h3>
                <div class="stats-grid">
                    <div class="stat-item">
                        <div class="stat-value">${totalOptions}</div>
                        <div class="stat-label">–í—Å–µ–≥–æ –æ–ø—Ü–∏–æ–Ω–æ–≤ (–¥–Ω–µ–π ‚â• ${minDays})</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-value" style="color: #27ae60;">${highLiquidity}</div>
                        <div class="stat-label">–í—ã—Å–æ–∫–∞—è –ª–∏–∫–≤–∏–¥–Ω–æ—Å—Ç—å (70+)</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-value" style="color: #f39c12;">${mediumLiquidity}</div>
                        <div class="stat-label">–°—Ä–µ–¥–Ω—è—è –ª–∏–∫–≤–∏–¥–Ω–æ—Å—Ç—å (40-69)</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-value" style="color: #e74c3c;">${lowLiquidity}</div>
                        <div class="stat-label">–ù–∏–∑–∫–∞—è –ª–∏–∫–≤–∏–¥–Ω–æ—Å—Ç—å (<40)</div>
                    </div>
                </div>
            `;
            
            document.getElementById('stats').innerHTML = statsHtml;
            document.getElementById('stats').style.display = 'block';
            
            // –°–ø–∏—Å–æ–∫ –æ–ø—Ü–∏–æ–Ω–æ–≤
            let resultsHtml = `
                <h3>üèÜ –†–µ–π—Ç–∏–Ω–≥ –ª–∏–∫–≤–∏–¥–Ω–æ—Å—Ç–∏ –æ–ø—Ü–∏–æ–Ω–æ–≤ ${assetCode} ${optionType.toUpperCase()}</h3>
                <div class="info-box">
                    <strong>üí° –ü–æ–¥—Å–∫–∞–∑–∫–∞:</strong> –ê–Ω–∞–ª–∏–∑ –æ—Å–Ω–æ–≤–∞–Ω –Ω–∞ —Ç–µ–æ—Ä–µ—Ç–∏—á–µ—Å–∫–∏—Ö –ø–∞—Ä–∞–º–µ—Ç—Ä–∞—Ö. 
                    –í—ã—Å–æ–∫–∞—è –ª–∏–∫–≤–∏–¥–Ω–æ—Å—Ç—å = –º–Ω–æ–≥–æ –≤—Ä–µ–º–µ–Ω–∏ –¥–æ —ç–∫—Å–ø–∏—Ä–∞—Ü–∏–∏, —É–º–µ—Ä–µ–Ω–Ω–∞—è –≤–æ–ª–∞—Ç–∏–ª—å–Ω–æ—Å—Ç—å, –æ–ø—Ç–∏–º–∞–ª—å–Ω–∞—è —Ü–µ–Ω–∞.
                    –ù–∏–∑–∫–∞—è –ª–∏–∫–≤–∏–¥–Ω–æ—Å—Ç—å = –º–∞–ª–æ –≤—Ä–µ–º–µ–Ω–∏, –≤—ã—Å–æ–∫–∞—è –≤–æ–ª–∞—Ç–∏–ª—å–Ω–æ—Å—Ç—å, —ç–∫—Å—Ç—Ä–µ–º–∞–ª—å–Ω—ã–µ —Ü–µ–Ω—ã.
                </div>
                <div class="liquidity-grid">
            `;
            
            allLiquidityData.forEach((option, index) => {
                const scoreClass = option.liquidity.score >= 70 ? 'score-high' : 
                                 option.liquidity.score >= 40 ? 'score-medium' : 'score-low';
                const statusClass = option.status.class;
                const statusTextClass = `status-${option.status.class}`;
                
                const strike = parseFloat(option.secid.match(/\d+\.?\d*/)[0]);
                const spreadPercent = option.liquidity.spread ? (option.liquidity.spread * 100).toFixed(1) : 'N/A';
                
                // –§–æ—Ä–º–∞—Ç–∏—Ä—É–µ–º –¥–∞—Ç—É –ø–æ–≥–∞—à–µ–Ω–∏—è
                const expirationDate = option.expiring_date ? 
                    new Date(option.expiring_date).toLocaleDateString('ru-RU', { 
                        day: '2-digit', 
                        month: '2-digit', 
                        year: '2-digit' 
                    }) : 'N/A';
                
                resultsHtml += `
                    <div class="liquidity-card ${statusClass}">
                        <div class="liquidity-header">
                            <div class="option-title">#${index + 1} ${option.secid} <span style="color: #7f8c8d; font-size: 14px;">(${expirationDate})</span></div>
                            <div class="liquidity-score ${scoreClass}">${option.liquidity.score}/100</div>
                        </div>
                        
                        <div class="volume-details">
                            <div class="volume-item">
                                <div class="volume-value">${option.liquidity.daysToExpiry}</div>
                                <div class="volume-label">–î–Ω–µ–π</div>
                            </div>
                            <div class="volume-item">
                                <div class="volume-value">${option.liquidity.volatility.toFixed(1)}%</div>
                                <div class="volume-label">–í–æ–ª–∞—Ç–∏–ª—å–Ω–æ—Å—Ç—å</div>
                            </div>
                            <div class="volume-item">
                                <div class="volume-value">${(option.liquidity.priceRatio * 100).toFixed(1)}%</div>
                                <div class="volume-label">–¶–µ–Ω–∞/–ë–ê</div>
                            </div>
                            <div class="volume-item">
                                <div class="volume-value">${option.liquidity.delta.toFixed(3)}</div>
                                <div class="volume-label">Delta</div>
                            </div>
                        </div>
                        
                        <div class="liquidity-status ${statusTextClass}">
                            ${option.status.status}
                        </div>
                        
                        <div style="margin-top: 10px; font-size: 12px; color: #7f8c8d;">
                            <strong>–û–±–æ—Å–Ω–æ–≤–∞–Ω–∏–µ:</strong><br>
                            ${option.liquidity.reasons.slice(0, 2).join(', ')}
                        </div>
                    </div>
                `;
            });
            
            resultsHtml += '</div>';
            
            if (allLiquidityData.length === 0) {
                resultsHtml = `
                    <div class="info-box">
                        <h3>üìã –†–µ–∑—É–ª—å—Ç–∞—Ç—ã –∞–Ω–∞–ª–∏–∑–∞</h3>
                        <p><strong>–ù–µ –Ω–∞–π–¥–µ–Ω–æ –æ–ø—Ü–∏–æ–Ω–æ–≤</strong> —Å –≤—Ä–µ–º–µ–Ω–µ–º –¥–æ —ç–∫—Å–ø–∏—Ä–∞—Ü–∏–∏ ‚â• ${minDays} –¥–Ω–µ–π.</p>
                        <p>–ü–æ–ø—Ä–æ–±—É–π—Ç–µ:</p>
                        <ul>
                            <li>–£–º–µ–Ω—å—à–∏—Ç—å –º–∏–Ω–∏–º–∞–ª—å–Ω–æ–µ –≤—Ä–µ–º—è –¥–æ —ç–∫—Å–ø–∏—Ä–∞—Ü–∏–∏</li>
                            <li>–ü—Ä–æ–≤–µ—Ä–∏—Ç—å –¥—Ä—É–≥–æ–π –±–∞–∑–æ–≤—ã–π –∞–∫—Ç–∏–≤</li>
                            <li>–í—ã–±—Ä–∞—Ç—å –¥—Ä—É–≥–æ–π —Ç–∏–ø –æ–ø—Ü–∏–æ–Ω–∞</li>
                        </ul>
                    </div>
                `;
            }
            
            document.getElementById('results').innerHTML = resultsHtml;
        }
    </script>
</body>
</html>