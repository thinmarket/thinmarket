<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ThinMarket</title>
    <style>
        body {
            background-color: #2E2E2E;
            color: white;
            font-family: Arial, sans-serif;
            margin: 0;
            padding: 0;
            display: flex;
            flex-direction: column;
            min-height: 100vh;
        }
        .header {
            background-color: #1E1E1E;
            padding: 15px 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-shrink: 0;
        }
        .title-container {
            display: flex;
            align-items: center;
            gap: 20px;
            flex-wrap: wrap;
            width: 100%;
        }
        .time-container {
            display: flex;
            gap: 15px;
            align-items: center;
            flex-wrap: wrap;
            margin-top: 5px;
        }
        .time-display {
            font-size: 13px;
            color: #ccc;
            font-weight: normal;
            white-space: nowrap;
        }
        .utc-time {
            color: #4CAF50;
            font-weight: bold;
        }
        .image-button {
            height: 80px;
            margin: 10px;
            cursor: pointer;
            border-radius: 8px;
            transition: all 0.3s ease;
            box-shadow: 0 2px 5px rgba(0,0,0,0.2);
        }
        .image-button:hover {
            transform: translateY(-3px);
            box-shadow: 0 5px 15px rgba(0,0,0,0.3);
        }
        .button-container {
            display: flex;
            flex-wrap: wrap;
            padding: 15px;
            justify-content: flex-start;
            flex-grow: 1;
        }

        /* Блок с контентом (основной + боковая панель) */
        .content-wrapper {
            display: flex;
            flex-grow: 1;
            width: 100%;
        }
        .main-content {
            flex-grow: 1;
            width: 75%;
            padding: 10px;
        }
        .sidebar {
            width: 25%;
            min-width: 280px;
            background-color: #252525;
            padding: 10px;
            border-left: 1px solid #333;
            display: flex;
            flex-direction: column;
            gap: 15px;
        }

        h1 {
            font-size: 28px;
            margin: 0;
            color: #fff;
            font-weight: bold;
            min-width: 150px;
        }

        /* Стили для бегущей строки */
        .ticker-container {
            background-color: #1a1a1a;
            color: white;
            padding: 12px 0;
            overflow: hidden;
            position: relative;
            border-top: 1px solid #333;
            flex-shrink: 0;
        }
        .ticker {
            display: inline-block;
            white-space: nowrap;
            padding-left: 100%;
            animation: ticker 300s linear infinite;
        }
        .ticker-item {
            display: inline-block;
            margin-right: 40px;
            font-size: 14px;
        }
        .ticker-name {
            font-weight: bold;
            color: #fff;
        }
        .up { color: #4CAF50; }
        .down { color: #F44336; }
        @keyframes ticker {
            0% { transform: translateX(0); }
            100% { transform: translateX(-100%); }
        }

        /* Блоки в боковой панели */
        .panel-block {
            background-color: #252525;
            border-radius: 6px;
            padding: 10px;
            font-size: 12px;
            box-shadow: 0 1px 3px rgba(0,0,0,0.1);
        }
        .panel-block-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 8px;
            padding-bottom: 5px;
            border-bottom: 1px solid #333;
        }
        .panel-block-title {
            font-weight: bold;
            color: #fff;
            font-size: 13px;
        }
        .panel-block-toggle {
            background: none;
            border: none;
            color: #aaa;
            font-size: 11px;
            cursor: pointer;
            padding: 2px 6px;
            border-radius: 4px;
            transition: all 0.2s;
        }
        .panel-block-toggle:hover {
            background-color: #333;
            color: #fff;
        }
        .panel-block-content {
            display: block;
        }
        .collapsed .panel-block-content {
            display: none;
        }
        .collapsed .panel-block-toggle i {
            transform: rotate(-90deg);
        }

        /* Стили для списков */
        .list-item {
            display: flex;
            justify-content: space-between;
            padding: 5px 0;
            align-items: center;
            white-space: nowrap;
        }
        .list-name {
            font-weight: bold;
            overflow: hidden;
            text-overflow: ellipsis;
            max-width: 70px;
        }
        .list-value {
            text-align: right;
            min-width: 50px;
        }
        .list-change {
            text-align: right;
            font-weight: bold;
            min-width: 50px;
        }

        /* Колонки для топ-акций */
        .stocks-columns {
            display: flex;
            gap: 10px;
        }
        .stocks-column {
            flex: 1;
        }
        .column-title {
            font-size: 10px;
            margin-bottom: 4px;
            padding-bottom: 2px;
            border-bottom: 1px solid;
            display: flex;
            align-items: center;
            justify-content: space-between;
        }
        .column-title.up {
            color: #4CAF50;
            border-color: #4CAF50;
        }
        .column-title.down {
            color: #F44336;
            border-color: #F44336;
        }

        /* Время обновления */
        .update-time {
            font-size: 9px;
            color: #888;
            text-align: right;
            margin-top: 5px;
            white-space: nowrap;
        }

        /* Стили для конвертера валют */
        .converter-input {
            width: 100%;
            padding: 6px;
            margin: 5px 0;
            background-color: #333;
            border: 1px solid #444;
            color: white;
            border-radius: 4px;
        }
        .converter-select {
            width: 100%;
            padding: 6px;
            margin: 5px 0;
            background-color: #333;
            border: 1px solid #444;
            color: white;
            border-radius: 4px;
        }
        .converter-button {
            width: 100%;
            padding: 8px;
            margin: 5px 0;
            background-color: #4CAF50;
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
        }

        .converter-result {
            margin-top: 10px;
            padding: 8px;
            background-color: #333;
            border-radius: 4px;
            text-align: center;
            font-weight: bold;
        }

        @media (max-width: 768px) {
            .header {
                padding: 10px 15px;
            }
            
            .title-container {
                gap: 10px;
            }
            
            .time-container {
                gap: 5px;
                margin-top: 3px;
            }
            
            .time-display {
                font-size: 10px;
            }
            
            .button-container {
                justify-content: space-around;
                padding: 10px 5px;
            }
            
            .image-button {
                height: 60px;
                margin: 5px;
                flex: 0 0 calc(50% - 10px);
                max-width: calc(50% - 10px);
            }
            
            .sidebar {
                padding: 8px;
            }
            
            .panel-block {
                margin-bottom: 8px;
            }
            
            .ticker-container {
                padding: 8px 0;
            }
            
            .ticker-item {
                margin-right: 20px;
                font-size: 12px;
            }
        }

        @media (max-width: 480px) {
            .time-display {
                font-size: 9px;
            }
            
            .image-button {
                height: 50px;
                flex: 0 0 calc(100% - 10px);
                max-width: calc(100% - 10px);
            }
            
            .list-item {
                font-size: 11px;
                padding: 3px 0;
            }
            
            .panel-block-title {
                font-size: 12px;
            }
            
            .converter-input, .converter-select {
                padding: 5px;
            }
            
            .converter-button {
                padding: 6px;
            }
        }
    </style>
</head>
<body>
    <div class="header">
        <div class="title-container">
            <h1>ThinMarket</h1>
            <div class="time-container">
                <span class="time-display utc-time" id="utc-time"></span>
                <span class="time-display" id="moscow-time"></span>
                <span class="time-display" id="london-time"></span>
                <span class="time-display" id="newyork-time"></span>
                <span class="time-display" id="hongkong-time"></span>
                <span class="time-display" id="shanghai-time"></span>
            </div>
        </div>
    </div>
    
    <!-- Блок с бегущей строкой котировок -->
    <div class="ticker-container">
        <div class="ticker" id="ticker">Загрузка данных...</div>
    </div>
    
    <!-- Основное содержимое -->
    <div class="content-wrapper">
        <!-- Основная часть с кнопками -->
        <div class="main-content">
            <div class="button-container">
                <a href="products.html">
                    <img src="assets/img/buttons/color3.png" alt="Продукты" class="image-button">
                </a>
                <a href="services.html">
                    <img src="assets/img/buttons/color3.png" alt="Услуги" class="image-button">
                </a>
                <a href="promotions.html">
                    <img src="assets/img/buttons/color3.png" alt="Акции" class="image-button">
                </a>
                <a href="Thicalculator_Web.html">
                    <img src="assets/img/buttons/colorThincalculator-web.png" alt="Калькулятор" class="image-button">
                </a>
            </div>
        </div>
        
        <!-- Боковая панель с финансовой информацией -->
        <div class="sidebar">
            <!-- Блок с конвертером валют -->
            <div class="panel-block" id="currency-converter-block">
                <div class="panel-block-header">
                    <span class="panel-block-title">Конвертер валют</span>
                    <button class="panel-block-toggle" onclick="togglePanel('currency-converter-block')">
                        <i>▼</i>
                    </button>
                </div>
                <div class="panel-block-content">
                    <input type="number" id="converter-amount" class="converter-input" placeholder="Сумма" value="0">
                    
                    <select id="converter-from" class="converter-select">
                        <option value="RUB">Рубли (RUB)</option>
                        <option value="USD">Доллары (USD)</option>
                        <option value="EUR">Евро (EUR)</option>
                        <option value="CNY">Юань (CNY)</option>
                        <option value="BTC">Bitcoin (BTC)</option>
                        <option value="ETH">Ethereum (ETH)</option>
                        <option value="BNB">Binance Coin (BNB)</option>
                        <option value="SOL">Solana (SOL)</option>
                        <option value="XRP">Ripple (XRP)</option>
                    </select>
                    
                    <select id="converter-to" class="converter-select">
                        <option value="USD">Доллары (USD)</option>
                        <option value="RUB">Рубли (RUB)</option>
                        <option value="EUR">Евро (EUR)</option>
                        <option value="CNY">Юань (CNY)</option>
                        <option value="BTC">Bitcoin (BTC)</option>
                        <option value="ETH">Ethereum (ETH)</option>
                        <option value="BNB">Binance Coin (BNB)</option>
                        <option value="SOL">Solana (SOL)</option>
                        <option value="XRP">Ripple (XRP)</option>
                    </select>
                    
                    
                    <div id="converter-result" class="converter-result">Результат появится здесь</div>
                </div>
            </div>
            
            <!-- Блок с криптовалютами -->
            <div class="panel-block" id="crypto-block">
                <div class="panel-block-header">
                    <span class="panel-block-title">Криптовалюты</span>
                    <button class="panel-block-toggle" onclick="togglePanel('crypto-block')" title="Обновляется каждые 5 минут">
                        <i>▼</i>
                    </button>
                </div>
                <div class="panel-block-content">
                    <div id="crypto-rates"></div>
                    <div class="update-time">Обновление каждые 5 мин</div>
                </div>
            </div>
            
            <!-- Блок с топ-акциями -->
            <div class="panel-block" id="top-stocks-block">
                <div class="panel-block-header">
                    <span class="panel-block-title">Топ акции</span>
                    <button class="panel-block-toggle" onclick="togglePanel('top-stocks-block')" title="Обновляется каждые 30 секунд">
                        <i>▼</i>
                    </button>
                </div>
                <div class="panel-block-content">
                    <div class="stocks-columns">
                        <div class="stocks-column">
                            <div class="column-title up">Лидеры роста</div>
                            <div id="top-gainers"></div>
                        </div>
                        <div class="stocks-column">
                            <div class="column-title down">Лидеры снижения</div>
                            <div id="top-losers"></div>
                        </div>
                    </div>
                    <div class="update-time">Обновление каждые 30 сек</div>
                </div>
            </div>
            
            <!-- Блок с курсами валют -->
            <div class="panel-block" id="currency-rates-block">
                <div class="panel-block-header">
                    <span class="panel-block-title">Курсы валют ЦБ РФ</span>
                    <button class="panel-block-toggle" onclick="togglePanel('currency-rates-block')" title="Обновляется ежедневно">
                        <i>▼</i>
                    </button>
                </div>
                <div class="panel-block-content">
                    <div id="currency-rates"></div>
                    <div class="update-time" id="currency-update-time"></div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Функция для обновления времени
        function updateWorldTime() {
            const options = {
                hour: '2-digit',
                minute: '2-digit',
                second: '2-digit',
                hour12: false
            };
            
            // UTC time
            const utcOptions = {...options, timeZone: 'UTC'};
            const utcFormatter = new Intl.DateTimeFormat('ru-RU', utcOptions);
            const utcTime = utcFormatter.format(new Date());
            document.getElementById('utc-time').textContent = 'UTC: ' + utcTime;
            
            // Moscow time
            const moscowOptions = {...options, timeZone: 'Europe/Moscow'};
            const moscowFormatter = new Intl.DateTimeFormat('ru-RU', moscowOptions);
            const moscowTime = moscowFormatter.format(new Date());
            document.getElementById('moscow-time').textContent = 'Москва: ' + moscowTime;
            
            // London time
            const londonOptions = {...options, timeZone: 'Europe/London'};
            const londonFormatter = new Intl.DateTimeFormat('ru-RU', londonOptions);
            const londonTime = londonFormatter.format(new Date());
            document.getElementById('london-time').textContent = 'Лондон: ' + londonTime;
            
            // New York time
            const nyOptions = {...options, timeZone: 'America/New_York'};
            const nyFormatter = new Intl.DateTimeFormat('ru-RU', nyOptions);
            const nyTime = nyFormatter.format(new Date());
            document.getElementById('newyork-time').textContent = 'Нью-Йорк: ' + nyTime;
            
            // Hong Kong time
            const hkOptions = {...options, timeZone: 'Asia/Hong_Kong'};
            const hkFormatter = new Intl.DateTimeFormat('ru-RU', hkOptions);
            const hkTime = hkFormatter.format(new Date());
            document.getElementById('hongkong-time').textContent = 'Гонконг: ' + hkTime;
            
            // Shanghai time
            const shOptions = {...options, timeZone: 'Asia/Shanghai'};
            const shFormatter = new Intl.DateTimeFormat('ru-RU', shOptions);
            const shTime = shFormatter.format(new Date());
            document.getElementById('shanghai-time').textContent = 'Шанхай: ' + shTime;
        }
        
        // Конфигурация для котировок
        const config = {
            updateInterval: 30000, // Обновление каждые 30 секунд
            board: 'TQBR',
            animationDuration: 300,
            topStocksCount: 5
        };

        // Текущие курсы валют
        let currentRates = {
            USD: 0,
            EUR: 0,
            CNY: 0
        };

        // Текущие курсы криптовалют (в USD)
        let currentCryptoRates = {
            BTC: { price: 0, change: 0 },
            ETH: { price: 0, change: 0 },
            BNB: { price: 0, change: 0 },
            SOL: { price: 0, change: 0 },
            XRP: { price: 0, change: 0 }
        };

        // Основные функции для котировок
        async function loadData() {
            try {
                // Получаем список акций и их текущие цены
                const url = `https://iss.moex.com/iss/engines/stock/markets/shares/boards/${config.board}/securities.json?iss.meta=off&securities.columns=SECID,SHORTNAME&marketdata.columns=SECID,LAST,LASTTOPREVPRICE`;
                
                const response = await fetch(url);
                const data = await response.json();
                
                // Обрабатываем данные
                const securities = data.securities.data;
                const marketData = data.marketdata.data;
                
                // Создаем массив акций с данными
                const stocks = securities.map(security => {
                    const ticker = security[0];
                    const name = security[1];
                    const stockData = marketData.find(item => item[0] === ticker);
                    
                    return {
                        ticker,
                        name,
                        price: stockData ? stockData[1] : null,
                        change: stockData ? stockData[2] : null
                    };
                }).filter(stock => stock.price !== null && stock.change !== null);
                
                // Сортируем акции по изменению цены
                const sortedStocks = [...stocks].sort((a, b) => b.change - a.change);
                
                // Получаем топ роста и падения
                const topGainers = sortedStocks.slice(0, config.topStocksCount);
                const topLosers = sortedStocks.slice(-config.topStocksCount).reverse();
                
                // Обновляем топ-акции
                updateTopStocks('top-gainers', topGainers);
                updateTopStocks('top-losers', topLosers);
                
                // Создаем бегущую строку
                let tickerContent = '';
                
                stocks.forEach(stock => {
                    const changeClass = stock.change > 0 ? 'up' : (stock.change < 0 ? 'down' : '');
                    
                    tickerContent += `
                        <span class="ticker-item">
                            <span class="ticker-name">${stock.ticker}</span>
                            ${stock.price ? stock.price.toFixed(2) + ' RUB' : '-'}
                            <span class="${changeClass}">
                                ${stock.change ? (stock.change > 0 ? '+' : '') + stock.change.toFixed(2) + '%' : ''}
                            </span>
                        </span>
                    `;
                });
                
                document.getElementById('ticker').innerHTML = tickerContent;
                
                // Динамически регулируем скорость анимации
                adjustAnimationSpeed();
                
            } catch (error) {
                console.error('Ошибка:', error);
                document.getElementById('ticker').innerHTML = 'Ошибка загрузки данных';
                document.getElementById('top-gainers').innerHTML = '<div class="list-item">-</div>';
                document.getElementById('top-losers').innerHTML = '<div class="list-item">-</div>';
            }
        }

        // Функция для загрузки курсов валют с ЦБ РФ
        async function loadCurrencyRates() {
            try {
                // URL для получения курсов валют (доллар, евро, юань)
                const url = `https://www.cbr-xml-daily.ru/daily_json.js`;
                
                const response = await fetch(url);
                const data = await response.json();
                
                // Форматируем дату обновления
                const updateDate = new Date(data.Date);
                const options = {
                    day: '2-digit',
                    month: '2-digit',
                    year: 'numeric',
                    hour: '2-digit',
                    minute: '2-digit',
                    hour12: false
                };
                const formattedUpdateTime = updateDate.toLocaleString('ru-RU', options);
                
                // Обновляем время последнего обновления
                document.getElementById('currency-update-time').textContent = `Обновлено: ${formattedUpdateTime}`;
                
                // Получаем нужные валюты
                const usd = data.Valute.USD;
                const eur = data.Valute.EUR;
                const cny = data.Valute.CNY;
                
                // Сохраняем текущие курсы для конвертера
                currentRates.USD = usd.Value;
                currentRates.EUR = eur.Value;
                currentRates.CNY = cny.Value;
                
                // Рассчитываем изменение по сравнению с предыдущим значением
                const calculateChange = (current, previous) => {
                    return ((current - previous) / previous * 100).toFixed(2);
                };
                
                // Создаем HTML для отображения курсов валют
                let currencyContent = '';
                
                // Доллар США
                const usdChange = calculateChange(usd.Value, usd.Previous);
                const usdChangeClass = usdChange > 0 ? 'up' : (usdChange < 0 ? 'down' : '');
                currencyContent += `
                    <div class="list-item">
                        <span class="list-name" title="Доллар США">USD</span>
                        <span class="list-value">${usd.Value.toFixed(2)} ₽</span>
                        <span class="list-change ${usdChangeClass}">${usdChange > 0 ? '+' : ''}${usdChange}%</span>
                    </div>
                `;
                
                // Евро
                const eurChange = calculateChange(eur.Value, eur.Previous);
                const eurChangeClass = eurChange > 0 ? 'up' : (eurChange < 0 ? 'down' : '');
                currencyContent += `
                    <div class="list-item">
                        <span class="list-name" title="Евро">EUR</span>
                        <span class="list-value">${eur.Value.toFixed(2)} ₽</span>
                        <span class="list-change ${eurChangeClass}">${eurChange > 0 ? '+' : ''}${eurChange}%</span>
                    </div>
                `;
                
                // Китайский юань
                const cnyChange = calculateChange(cny.Value, cny.Previous);
                const cnyChangeClass = cnyChange > 0 ? 'up' : (cnyChange < 0 ? 'down' : '');
                currencyContent += `
                    <div class="list-item">
                        <span class="list-name" title="Китайский юань">CNY</span>
                        <span class="list-value">${cny.Value.toFixed(2)} ₽</span>
                        <span class="list-change ${cnyChangeClass}">${cnyChange > 0 ? '+' : ''}${cnyChange}%</span>
                    </div>
                `;
                
                document.getElementById('currency-rates').innerHTML = currencyContent;
                
            } catch (error) {
                console.error('Ошибка загрузки курсов валют:', error);
                document.getElementById('currency-rates').innerHTML = '<div class="list-item">Ошибка загрузки</div>';
                document.getElementById('currency-update-time').textContent = 'Ошибка обновления';
            }
        }

        // Функция для загрузки курсов криптовалют
        async function loadCryptoRates() {
            try {
                // Используем CoinGecko API без ключа (бесплатный лимит: 10-30 запросов в минуту)
                const url = 'https://api.coingecko.com/api/v3/coins/markets?vs_currency=usd&ids=bitcoin,ethereum,binancecoin,solana,ripple&price_change_percentage=24h';
                
                const response = await fetch(url);
                const data = await response.json();
                
                // Обновляем данные
                data.forEach(crypto => {
                    const symbol = crypto.symbol.toUpperCase();
                    if (currentCryptoRates[symbol]) {
                        currentCryptoRates[symbol].price = crypto.current_price;
                        currentCryptoRates[symbol].change = crypto.price_change_percentage_24h;
                    }
                });
                
                // Обновляем отображение
                updateCryptoDisplay();
                
            } catch (error) {
                console.error('Ошибка загрузки криптовалют:', error);
                document.getElementById('crypto-rates').innerHTML = '<div class="list-item">Ошибка загрузки</div>';
            }
        }

        // Функция для обновления отображения криптовалют
        function updateCryptoDisplay() {
            const container = document.getElementById('crypto-rates');
            container.innerHTML = '';
            
            // Добавляем основные криптовалюты
            Object.entries(currentCryptoRates).forEach(([symbol, data]) => {
                const changeClass = data.change > 0 ? 'up' : (data.change < 0 ? 'down' : '');
                const changeSign = data.change > 0 ? '+' : '';
                
                const cryptoElement = document.createElement('div');
                cryptoElement.className = 'list-item';
                cryptoElement.innerHTML = `
                    <span class="list-name" title="${getCryptoName(symbol)}">${symbol}</span>
                    <span class="list-value">${data.price.toFixed(2)} $</span>
                    <span class="list-change ${changeClass}">${changeSign}${data.change.toFixed(2)}%</span>
                `;
                
                container.appendChild(cryptoElement);
            });
        }

        // Вспомогательная функция для получения полного названия криптовалюты
        function getCryptoName(symbol) {
            const names = {
                'BTC': 'Bitcoin',
                'ETH': 'Ethereum',
                'BNB': 'Binance Coin',
                'SOL': 'Solana',
                'XRP': 'Ripple'
            };
            return names[symbol] || symbol;
        }

        function convertCurrency() {
            const amount = parseFloat(document.getElementById('converter-amount').value);
            if (isNaN(amount)) {
                document.getElementById('converter-result').textContent = 'Введите корректную сумму';
                return;
            }
            
            const fromCurrency = document.getElementById('converter-from').value;
            const toCurrency = document.getElementById('converter-to').value;
            
            if (fromCurrency === toCurrency) {
                document.getElementById('converter-result').textContent = 'Выберите разные валюты';
                return;
            }
            
            let result = 0;
            let resultText = '';
            
            // Если конвертация между фиатными валютами
            if (['RUB', 'USD', 'EUR', 'CNY'].includes(fromCurrency) && ['RUB', 'USD', 'EUR', 'CNY'].includes(toCurrency)) {
                // Конвертация из рублей в другую валюту
                if (fromCurrency === 'RUB') {
                    if (toCurrency === 'USD') {
                        result = amount / currentRates.USD;
                        resultText = `${amount.toFixed(2)} RUB = ${result.toFixed(2)} USD`;
                    } else if (toCurrency === 'EUR') {
                        result = amount / currentRates.EUR;
                        resultText = `${amount.toFixed(2)} RUB = ${result.toFixed(2)} EUR`;
                    } else if (toCurrency === 'CNY') {
                        result = amount / currentRates.CNY;
                        resultText = `${amount.toFixed(2)} RUB = ${result.toFixed(2)} CNY`;
                    }
                }
                // Конвертация из другой валюты в рубли
                else if (toCurrency === 'RUB') {
                    if (fromCurrency === 'USD') {
                        result = amount * currentRates.USD;
                        resultText = `${amount.toFixed(2)} USD = ${result.toFixed(2)} RUB`;
                    } else if (fromCurrency === 'EUR') {
                        result = amount * currentRates.EUR;
                        resultText = `${amount.toFixed(2)} EUR = ${result.toFixed(2)} RUB`;
                    } else if (fromCurrency === 'CNY') {
                        result = amount * currentRates.CNY;
                        resultText = `${amount.toFixed(2)} CNY = ${result.toFixed(2)} RUB`;
                    }
                }
                // Конвертация между двумя валютами (не рублями)
                else {
                    // Сначала конвертируем в рубли, затем в целевую валюту
                    let rubAmount = 0;
                    if (fromCurrency === 'USD') {
                        rubAmount = amount * currentRates.USD;
                    } else if (fromCurrency === 'EUR') {
                        rubAmount = amount * currentRates.EUR;
                    } else if (fromCurrency === 'CNY') {
                        rubAmount = amount * currentRates.CNY;
                    }
                    
                    if (toCurrency === 'USD') {
                        result = rubAmount / currentRates.USD;
                        resultText = `${amount.toFixed(2)} ${fromCurrency} = ${result.toFixed(2)} USD`;
                    } else if (toCurrency === 'EUR') {
                        result = rubAmount / currentRates.EUR;
                        resultText = `${amount.toFixed(2)} ${fromCurrency} = ${result.toFixed(2)} EUR`;
                    } else if (toCurrency === 'CNY') {
                        result = rubAmount / currentRates.CNY;
                        resultText = `${amount.toFixed(2)} ${fromCurrency} = ${result.toFixed(2)} CNY`;
                    }
                }
            }
            // Если конвертация с участием криптовалют
            else {
                // Сначала конвертируем в USD (так как курсы криптовалют у нас в USD)
                let usdAmount = 0;
                
                // Если исходная валюта - фиатная
                if (fromCurrency === 'USD') {
                    usdAmount = amount;
                } else if (fromCurrency === 'RUB') {
                    usdAmount = amount / currentRates.USD;
                } else if (fromCurrency === 'EUR') {
                    usdAmount = amount * (currentRates.USD / currentRates.EUR);
                } else if (fromCurrency === 'CNY') {
                    usdAmount = amount * (currentRates.USD / currentRates.CNY);
                }
                // Если исходная валюта - криптовалюта
                else if (['BTC', 'ETH', 'BNB', 'SOL', 'XRP'].includes(fromCurrency)) {
                    usdAmount = amount * currentCryptoRates[fromCurrency].price;
                }
                
                // Теперь конвертируем из USD в целевую валюту
                if (toCurrency === 'USD') {
                    result = usdAmount;
                    resultText = `${amount.toFixed(8)} ${fromCurrency} = ${result.toFixed(2)} USD`;
                } else if (toCurrency === 'RUB') {
                    result = usdAmount * currentRates.USD;
                    resultText = `${amount.toFixed(8)} ${fromCurrency} = ${result.toFixed(2)} RUB`;
                } else if (toCurrency === 'EUR') {
                    result = usdAmount * (currentRates.EUR / currentRates.USD);
                    resultText = `${amount.toFixed(8)} ${fromCurrency} = ${result.toFixed(2)} EUR`;
                } else if (toCurrency === 'CNY') {
                    result = usdAmount * (currentRates.CNY / currentRates.USD);
                    resultText = `${amount.toFixed(8)} ${fromCurrency} = ${result.toFixed(2)} CNY`;
                }
                // Если целевая валюта - криптовалюта
                else if (['BTC', 'ETH', 'BNB', 'SOL', 'XRP'].includes(toCurrency)) {
                    result = usdAmount / currentCryptoRates[toCurrency].price;
                    resultText = `${amount.toFixed(8)} ${fromCurrency} = ${result.toFixed(8)} ${toCurrency}`;
                }
            }
            
            document.getElementById('converter-result').textContent = resultText;
        }

        // Обновление списка топ-акций
        function updateTopStocks(elementId, stocks) {
            const container = document.getElementById(elementId);
            container.innerHTML = '';
            
            stocks.forEach(stock => {
                const changeClass = stock.change > 0 ? 'up' : 'down';
                const changeSign = stock.change > 0 ? '+' : '';
                
                const stockElement = document.createElement('div');
                stockElement.className = 'list-item';
                stockElement.innerHTML = `
                    <span class="list-name" title="${stock.name}">${stock.ticker}</span>
                    <span class="list-value">${stock.price.toFixed(2)}</span>
                    <span class="list-change ${changeClass}">${changeSign}${stock.change.toFixed(2)}%</span>
                `;
                
                container.appendChild(stockElement);
            });
        }

        // Регулировка скорости анимации
        function adjustAnimationSpeed() {
            const ticker = document.getElementById('ticker');
            const itemsCount = ticker.querySelectorAll('.ticker-item').length;
            
            // Рассчитываем оптимальное время анимации
            const duration = Math.max(120, itemsCount * 2); // Минимум 120 секунд
            
            ticker.style.animationDuration = `${duration}s`;
        }

        // Переключение отображения панели
        function togglePanel(panelId) {
            const panel = document.getElementById(panelId);
            panel.classList.toggle('collapsed');
            
            // Сохраняем состояние в localStorage
            const isCollapsed = panel.classList.contains('collapsed');
            localStorage.setItem(`${panelId}-collapsed`, isCollapsed);
        }

        // Инициализация - восстанавливаем состояние из localStorage
        function initPanels() {
            const panels = ['currency-converter-block', 'top-stocks-block', 'currency-rates-block', 'crypto-block'];
            
            panels.forEach(panelId => {
                const isCollapsed = localStorage.getItem(`${panelId}-collapsed`) === 'true';
                const panel = document.getElementById(panelId);
                
                if (isCollapsed) {
                    panel.classList.add('collapsed');
                }
            });
            
            // На мобильных сворачиваем по умолчанию
            if (window.innerWidth <= 768) {
                panels.forEach(panelId => {
                    if (!localStorage.getItem(`${panelId}-collapsed`)) {
                        const panel = document.getElementById(panelId);
                        panel.classList.add('collapsed');
                    }
                });
            }
        }

        // Запускаем обновление времени и котировок
        updateWorldTime();
        setInterval(updateWorldTime, 1000);
        
        loadData();
        setInterval(loadData, config.updateInterval);
        
        loadCurrencyRates();
        // Обновляем курсы валют каждые 4 часа (так как ЦБ обновляет их раз в день)
        setInterval(loadCurrencyRates, 4 * 60 * 60 * 1000);
        
        // Загружаем криптовалюты при старте и каждые 5 минут
        loadCryptoRates();
        setInterval(loadCryptoRates, 5 * 60 * 1000);

        // Автоматическая конвертация при изменении значений
        document.getElementById('converter-amount').addEventListener('input', convertCurrency);
        document.getElementById('converter-from').addEventListener('change', convertCurrency);
        document.getElementById('converter-to').addEventListener('change', convertCurrency);

        window.addEventListener('load', initPanels);
    </script>
</body>
</html>
