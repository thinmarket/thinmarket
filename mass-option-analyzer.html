<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–ú–∞—Å—Å–æ–≤—ã–π –ê–Ω–∞–ª–∏–∑–∞—Ç–æ—Ä –û–ø—Ü–∏–æ–Ω–æ–≤ - –†–µ–π—Ç–∏–Ω–≥ –∏ –í—ã–±–æ—Ä</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 1600px;
            margin: 0 auto;
            padding: 20px;
            background-color: #232323;
            color: #fff;
        }
        .container {
            background: #2E2E2E;
            padding: 25px;
            border-radius: 15px;
            box-shadow: 0 4px 20px rgba(0,0,0,0.18);
            margin-bottom: 25px;
        }
        h1 {
            color: #4CAF50;
            text-align: center;
            margin-bottom: 30px;
            font-size: 28px;
        }
        h2, h3 {
            color: #fff;
        }
        .filters {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 25px;
        }
        .input-group {
            margin-bottom: 15px;
        }
        label {
            display: block;
            margin-bottom: 8px;
            font-weight: bold;
            color: #4CAF50;
            font-size: 16px;
        }
        input, select {
            width: 100%;
            padding: 12px;
            border: 2px solid #444;
            border-radius: 8px;
            font-size: 16px;
            background: #181818;
            color: #fff;
            box-sizing: border-box;
        }
        input:focus, select:focus {
            border-color: #4CAF50;
            outline: none;
        }
        button {
            background: linear-gradient(135deg, #4CAF50, #2980b9);
            color: white;
            padding: 15px 25px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-size: 16px;
            margin: 8px;
            font-weight: bold;
            transition: transform 0.2s, background 0.2s;
            width: 100%;
        }
        button:hover {
            transform: translateY(-2px);
            background: linear-gradient(135deg, #2980b9, #4CAF50);
        }
        .results-container {
            margin-top: 25px;
        }
        .options-list {
            display: grid;
            gap: 15px;
        }
        .option-card {
            background: #232323;
            padding: 20px;
            border-radius: 12px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.18);
            cursor: pointer;
            transition: all 0.3s ease;
            border-left: 6px solid #3498db;
        }
        .option-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 20px rgba(76,175,80,0.18);
        }
        .option-card.excellent {
            border-left-color: #27ae60;
            background: linear-gradient(135deg, #1b2e1b, #232323);
        }
        .option-card.good {
            border-left-color: #f39c12;
            background: linear-gradient(135deg, #2e2a1b, #232323);
        }
        .option-card.poor {
            border-left-color: #e74c3c;
            background: linear-gradient(135deg, #2e1b1b, #232323);
        }
        .option-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }
        .option-title {
            font-size: 20px;
            font-weight: bold;
            color: #fff;
        }
        .option-score {
            background: #181818;
            padding: 8px 15px;
            border-radius: 20px;
            font-weight: bold;
            font-size: 18px;
        }
        .score-excellent { color: #27ae60; }
        .score-good { color: #f39c12; }
        .score-poor { color: #e74c3c; }
        .option-details {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 15px;
            margin-bottom: 15px;
        }
        .detail-item {
            text-align: center;
            padding: 10px;
            background: #181818;
            border-radius: 8px;
        }
        .detail-value {
            font-size: 18px;
            font-weight: bold;
            color: #fff;
        }
        .detail-label {
            font-size: 12px;
            color: #7f8c8d;
            margin-top: 5px;
        }
        .option-recommendation {
            font-weight: bold;
            font-size: 16px;
            margin-top: 10px;
        }
        .recommendation-buy { color: #27ae60; }
        .recommendation-hold { color: #f39c12; }
        .recommendation-sell { color: #e74c3c; }
        
        /* –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ */
        .modal {
            display: none;
            position: fixed;
            z-index: 1000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0,0,0,0.7);
            overflow-y: auto;
        }
        .modal-content {
            background: #232323;
            margin: 20px auto;
            padding: 30px;
            border-radius: 15px;
            width: 90%;
            max-width: 1200px;
            position: relative;
            max-height: 90vh;
            overflow-y: auto;
            color: #fff;
        }
        .close {
            position: absolute;
            right: 20px;
            top: 20px;
            font-size: 28px;
            font-weight: bold;
            cursor: pointer;
            color: #aaa;
        }
        .close:hover {
            color: #fff;
        }
        .modal-header {
            margin-bottom: 25px;
            padding-bottom: 15px;
            border-bottom: 2px solid #333;
        }
        .modal-title {
            font-size: 24px;
            font-weight: bold;
            color: #4CAF50;
            margin-bottom: 10px;
        }
        .modal-subtitle {
            color: #bbb;
            font-size: 16px;
        }
        
        /* –°—Ç–∏–ª–∏ –¥–ª—è –¥–µ—Ç–∞–ª—å–Ω–æ–≥–æ –∞–Ω–∞–ª–∏–∑–∞ –≤ –º–æ–¥–∞–ª–∫–µ */
        .trade-recommendation {
            background: linear-gradient(135deg, #232323, #1b2e1b);
            padding: 20px;
            border-radius: 12px;
            margin: 20px 0;
            border: 2px solid #27ae60;
            color: #27ae60;
        }
        .recommendation-buy {
            background: linear-gradient(135deg, #1b2e1b, #232323);
            border-color: #27ae60;
        }
        .recommendation-hold {
            background: linear-gradient(135deg, #2e2a1b, #232323);
            border-color: #f39c12;
            color: #f39c12;
        }
        .recommendation-sell {
            background: linear-gradient(135deg, #2e1b1b, #232323);
            border-color: #e74c3c;
            color: #e74c3c;
        }
        .score-card {
            background: #181818;
            padding: 20px;
            border-radius: 10px;
            margin: 15px 0;
            box-shadow: 0 2px 10px rgba(0,0,0,0.12);
        }
        .score-bar {
            background: #333;
            height: 30px;
            border-radius: 15px;
            overflow: hidden;
            margin: 10px 0;
        }
        .score-fill {
            height: 100%;
            transition: width 0.5s;
            border-radius: 15px;
        }
        .score-excellent { background: linear-gradient(90deg, #27ae60, #2ecc71); 
            color: white; /* –ë–µ–ª—ã–π —Ç–µ–∫—Å—Ç –¥–ª—è –∑–µ–ª–µ–Ω–æ–≥–æ —Ñ–æ–Ω–∞ */
        }
        .score-good { background: linear-gradient(90deg, #f39c12, #f1c40f); 
            color: black; /* –ß–µ—Ä–Ω—ã–π —Ç–µ–∫—Å—Ç –¥–ª—è –∂–µ–ª—Ç–æ–≥–æ/–æ—Ä–∞–Ω–∂–µ–≤–æ–≥–æ —Ñ–æ–Ω–∞ */
        }
        .score-poor { background: linear-gradient(90deg, #e74c3c, #c0392b); 
            color: white; /* –ë–µ–ª—ã–π —Ç–µ–∫—Å—Ç –¥–ª—è –∫—Ä–∞—Å–Ω–æ–≥–æ —Ñ–æ–Ω–∞ */
        }
        .price-analysis {
            background: #181818;
            padding: 20px;
            border-radius: 10px;
            margin: 20px 0;
        }
        .price-breakdown {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin: 15px 0;
        }
        .price-item {
            background: #232323;
            padding: 15px;
            border-radius: 8px;
            text-align: center;
            box-shadow: 0 2px 5px rgba(0,0,0,0.10);
        }
        .price-value {
            font-size: 24px;
            font-weight: bold;
            color: #fff;
        }
        .price-label {
            font-size: 14px;
            color: #7f8c8d;
            margin-top: 5px;
        }
        .pros-cons {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin: 20px 0;
        }
        .pros, .cons {
            padding: 15px;
            border-radius: 8px;
        }
        .pros {
            background: #1b2e1b;
            border-left: 4px solid #27ae60;
        }
        .cons {
            background: #2e1b1b;
            border-left: 4px solid #e74c3c;
        }
        .pros h4, .cons h4 {
            margin-top: 0;
            color: #fff;
        }
        .pros ul, .cons ul {
            margin: 10px 0;
            padding-left: 20px;
        }
        .pros li, .cons li {
            margin: 5px 0;
            line-height: 1.4;
        }
        .analysis-section {
            background: #181818;
            padding: 20px;
            border-radius: 10px;
            margin: 15px 0;
            border-left: 4px solid #3498db;
        }
        .analysis-section h3 {
            color: #4CAF50;
            margin-top: 0;
            font-size: 20px;
        }
        
        .loading {
            text-align: center;
            padding: 40px;
            font-size: 18px;
            color: #4CAF50;
        }
        .spinner {
            border: 4px solid #333;
            border-top: 4px solid #4CAF50;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
            margin: 0 auto 20px;
        }
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        .stats-bar {
            background: #181818;
            padding: 15px;
            border-radius: 10px;
            margin: 20px 0;
            text-align: center;
            color: #fff;
        }
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 15px;
            margin-top: 15px;
        }
        .stat-item {
            background: #232323;
            padding: 15px;
            border-radius: 8px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.10);
        }
        .stat-value {
            font-size: 24px;
            font-weight: bold;
            color: #fff;
        }
        .stat-label {
            font-size: 14px;
            color: #7f8c8d;
            margin-top: 5px;
        }
        /* –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏–æ–Ω–Ω—ã–µ –∏ –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–∞—é—â–∏–µ –±–ª–æ–∫–∏ */
        .info-box {
            background: #181818;
            border: 1px solid #333;
            border-radius: 8px;
            padding: 15px;
            margin: 20px 0;
            color: #4CAF50;
        }
        .warning-box {
            background: #2e1b1b;
            border: 1px solid #e74c3c;
            border-radius: 8px;
            padding: 15px;
            margin: 20px 0;
            color: #e74c3c;
        }
    </style>
</head>
<body>
    <h1> –ú–∞—Å—Å–æ–≤—ã–π –ê–Ω–∞–ª–∏–∑–∞—Ç–æ—Ä –û–ø—Ü–∏–æ–Ω–æ–≤ - –†–µ–π—Ç–∏–Ω–≥ –∏ –í—ã–±–æ—Ä</h1>
    
    <div class="container">
        <h2>üéØ –ù–∞—Å—Ç—Ä–æ–π–∫–∏ –∞–Ω–∞–ª–∏–∑–∞</h2>
        
        <div class="filters">
            <div class="input-group">
                <label for="assetCode">–ö–æ–¥ –±–∞–∑–æ–≤–æ–≥–æ –∞–∫—Ç–∏–≤–∞:</label>
                <input type="text" id="assetCode" value="CNY" placeholder="–ù–∞–ø—Ä–∏–º–µ—Ä: CNY, SI, SBER">
            </div>
            
            <div class="input-group">
                <label for="optionType">–¢–∏–ø –æ–ø—Ü–∏–æ–Ω–∞:</label>
                <select id="optionType">
                    <option value="call">CALL (–ö–æ–ª–ª)</option>
                    <option value="put">PUT (–ü—É—Ç)</option>
                </select>
            </div>
            
            <div class="input-group">
                <label for="tradeType">–¢–∏–ø —Å–¥–µ–ª–∫–∏:</label>
                <select id="tradeType">
                    <option value="buy">–ü–û–ö–£–ü–ö–ê</option>
                    <option value="sell">–ü–†–û–î–ê–ñ–ê</option>
                </select>
            </div>
        </div>
        
        <button onclick="analyzeAllOptions()">üîç –ê–Ω–∞–ª–∏–∑–∏—Ä–æ–≤–∞—Ç—å –≤—Å–µ –æ–ø—Ü–∏–æ–Ω—ã</button>
        
        <div id="stats" class="stats-bar" style="display: none;"></div>
        <div id="results" class="results-container" style="display: none;"></div>
    </div>

    <!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ -->
    <div id="optionModal" class="modal">
        <div class="modal-content">
            <span class="close" onclick="closeModal()">&times;</span>
            <div id="modalContent"></div>
        </div>
    </div>

    <script>
        let allOptionsData = [];
        let currentModalData = null;

        // –í—Å–ø–æ–º–æ–≥–∞—Ç–µ–ª—å–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è –¥–ª—è –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è —Ç–∏–ø–∞ –æ–ø—Ü–∏–æ–Ω–∞ –∏–∑ –¥–∞–Ω–Ω—ã—Ö API
        function getOptionType(data) {
            // –ò—Å–ø–æ–ª—å–∑—É–µ–º –ø–æ–ª–µ option_type –∏–∑ API, –µ—Å–ª–∏ –æ–Ω–æ –µ—Å—Ç—å
            if (data.option_type) {
                return data.option_type.toLowerCase();
            }
            
            // Fallback: –æ–ø—Ä–µ–¥–µ–ª—è–µ–º –ø–æ SECID (–¥–ª—è —Å–ª—É—á–∞–µ–≤, –∫–æ–≥–¥–∞ option_type –æ—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç)
            const secid = data.secid || data;
            const lastBIndex = secid.lastIndexOf('B');
            const lastUIndex = secid.lastIndexOf('U');
            return lastBIndex > lastUIndex ? 'call' : 'put';
        }

        async function makeRequest(url) {
            try {
                const response = await fetch(url);
                const data = await response.json();
                return { status: response.status, data: data };
            } catch (error) {
                return { status: 'ERROR', data: { error: error.message } };
            }
        }

        function calculateProfitPotential(data) {
            const underlyingPrice = data.underlying_price;
            const strike = parseFloat(data.secid.match(/\d+\.?\d*/)[0]);
            const optionType = getOptionType(data);
            
            console.log(`–ê–Ω–∞–ª–∏–∑ ${data.secid}: —Ç–∏–ø=${optionType} (–∏–∑ ${data.option_type ? 'API' : 'SECID'})`);
            const daysToExpiry = data.days_until_expiring;
            const volatility = data.volatility;
            const theorPrice = data.theorprice;
            
            let score = 0;
            let reasons = [];
            
            // –ê–Ω–∞–ª–∏–∑ –¥–µ–Ω–µ–∂–Ω–æ—Å—Ç–∏ –¥–ª—è CALL
            if (optionType === 'call') {
                const moneyness = (underlyingPrice - strike) / strike;
                
                if (moneyness > 0.05) {
                    score += 30;
                    reasons.push("‚úÖ –û–ø—Ü–∏–æ–Ω –≤ –¥–µ–Ω—å–≥–∞—Ö - —É–∂–µ –µ—Å—Ç—å –ø—Ä–∏–±—ã–ª—å");
                } else if (moneyness > -0.02) {
                    score += 20;
                    reasons.push("‚úÖ –û–ø—Ü–∏–æ–Ω –æ–∫–æ–ª–æ –¥–µ–Ω–µ–≥ - –±–ª–∏–∑–∫–æ –∫ –ø—Ä–∏–±—ã–ª–∏");
                } else if (moneyness > -0.05) {
                    score += 10;
                    reasons.push("‚ö†Ô∏è –û–ø—Ü–∏–æ–Ω –Ω–µ–¥–∞–ª–µ–∫–æ –æ—Ç –¥–µ–Ω–µ–≥");
                } else {
                    score -= 10;
                    reasons.push("‚ùå –û–ø—Ü–∏–æ–Ω –¥–∞–ª–µ–∫–æ –æ—Ç –¥–µ–Ω–µ–≥ - –Ω—É–∂–µ–Ω —Å–∏–ª—å–Ω—ã–π —Ä–æ—Å—Ç");
                }
            }
            
            // –ê–Ω–∞–ª–∏–∑ –≤—Ä–µ–º–µ–Ω–∏ –¥–æ —ç–∫—Å–ø–∏—Ä–∞—Ü–∏–∏
            if (daysToExpiry <= 7) {
                score -= 20;
                reasons.push("‚ùå –û—á–µ–Ω—å –º–∞–ª–æ –≤—Ä–µ–º–µ–Ω–∏ - –±—ã—Å—Ç—Ä–æ–µ –æ–±–µ—Å—Ü–µ–Ω–∏–≤–∞–Ω–∏–µ");
            } else if (daysToExpiry <= 14) {
                score -= 10;
                reasons.push("‚ö†Ô∏è –ú–∞–ª–æ –≤—Ä–µ–º–µ–Ω–∏ - –≤—ã—Å–æ–∫–∏–µ –≤—Ä–µ–º–µ–Ω–Ω—ã–µ –∏–∑–¥–µ—Ä–∂–∫–∏");
            } else if (daysToExpiry <= 30) {
                score += 10;
                reasons.push("‚úÖ –û–ø—Ç–∏–º–∞–ª—å–Ω–æ–µ –≤—Ä–µ–º—è - –±–∞–ª–∞–Ω—Å —Å—Ç–æ–∏–º–æ—Å—Ç–∏ –∏ –≤—Ä–µ–º–µ–Ω–∏");
            } else if (daysToExpiry <= 90) {
                score += 15;
                reasons.push("‚úÖ –•–æ—Ä–æ—à–µ–µ –≤—Ä–µ–º—è - –µ—Å—Ç—å –≤—Ä–µ–º—è –¥–ª—è —Ä–∞–∑–≤–∏—Ç–∏—è");
            } else {
                score += 5;
                reasons.push("‚ö†Ô∏è –ú–Ω–æ–≥–æ –≤—Ä–µ–º–µ–Ω–∏ - –¥–æ—Ä–æ–≥–∞—è –≤—Ä–µ–º–µ–Ω–Ω–∞—è —Å—Ç–æ–∏–º–æ—Å—Ç—å");
            }
            
            // –ê–Ω–∞–ª–∏–∑ –≤–æ–ª–∞—Ç–∏–ª—å–Ω–æ—Å—Ç–∏
            if (volatility > 60) {
                score -= 15;
                reasons.push("‚ùå –û—á–µ–Ω—å –≤—ã—Å–æ–∫–∞—è –≤–æ–ª–∞—Ç–∏–ª—å–Ω–æ—Å—Ç—å - –¥–æ—Ä–æ–≥–æ–π –æ–ø—Ü–∏–æ–Ω");
            } else if (volatility > 40) {
                score -= 5;
                reasons.push("‚ö†Ô∏è –í—ã—Å–æ–∫–∞—è –≤–æ–ª–∞—Ç–∏–ª—å–Ω–æ—Å—Ç—å - –ø–æ–≤—ã—à–µ–Ω–Ω–∞—è —Å—Ç–æ–∏–º–æ—Å—Ç—å");
            } else if (volatility > 20) {
                score += 10;
                reasons.push("‚úÖ –£–º–µ—Ä–µ–Ω–Ω–∞—è –≤–æ–ª–∞—Ç–∏–ª—å–Ω–æ—Å—Ç—å - —Ä–∞–∑—É–º–Ω–∞—è —Ü–µ–Ω–∞");
            } else {
                score += 5;
                reasons.push("‚úÖ –ù–∏–∑–∫–∞—è –≤–æ–ª–∞—Ç–∏–ª—å–Ω–æ—Å—Ç—å - –¥–µ—à–µ–≤—ã–π –æ–ø—Ü–∏–æ–Ω");
            }
            
            // –ê–Ω–∞–ª–∏–∑ —Å–æ–æ—Ç–Ω–æ—à–µ–Ω–∏—è —Ü–µ–Ω–∞/—Å—Ç—Ä–∞–π–∫
            const priceRatio = theorPrice / underlyingPrice;
            if (priceRatio < 0.02) {
                score += 15;
                reasons.push("‚úÖ –û—á–µ–Ω—å –¥–µ—à–µ–≤—ã–π –æ–ø—Ü–∏–æ–Ω - –Ω–∏–∑–∫–∏–π —Ä–∏—Å–∫");
            } else if (priceRatio < 0.05) {
                score += 10;
                reasons.push("‚úÖ –î–µ—à–µ–≤—ã–π –æ–ø—Ü–∏–æ–Ω - —Ö–æ—Ä–æ—à–µ–µ —Å–æ–æ—Ç–Ω–æ—à–µ–Ω–∏–µ");
            } else if (priceRatio < 0.1) {
                score += 5;
                reasons.push("‚úÖ –£–º–µ—Ä–µ–Ω–Ω–∞—è —Ü–µ–Ω–∞");
            } else {
                score -= 10;
                reasons.push("‚ùå –î–æ—Ä–æ–≥–æ–π –æ–ø—Ü–∏–æ–Ω - –≤—ã—Å–æ–∫–∏–π —Ä–∏—Å–∫");
            }
            
            return { score: Math.max(0, Math.min(100, score)), reasons };
        }

        function getTradeRecommendation(score) {
            if (score >= 70) {
                return {
                    action: 'BUY',
                    class: 'recommendation-buy',
                    title: 'üü¢ –°–ò–õ–¨–ù–ê–Ø –ü–û–ö–£–ü–ö–ê',
                    description: '–≠—Ç–æ—Ç –æ–ø—Ü–∏–æ–Ω –∏–º–µ–µ—Ç –æ—Ç–ª–∏—á–Ω—ã–π –ø–æ—Ç–µ–Ω—Ü–∏–∞–ª –¥–ª—è –ø—Ä–∏–±—ã–ª–∏ —Å —Ä–∞–∑—É–º–Ω—ã–º —Ä–∏—Å–∫–æ–º.'
                };
            } else if (score >= 50) {
                return {
                    action: 'HOLD',
                    class: 'recommendation-hold',
                    title: 'üü° –£–ú–ï–†–ï–ù–ù–ê–Ø –ü–û–ö–£–ü–ö–ê',
                    description: '–û–ø—Ü–∏–æ–Ω –∏–º–µ–µ—Ç –ø–æ—Ç–µ–Ω—Ü–∏–∞–ª, –Ω–æ –µ—Å—Ç—å —Ä–∏—Å–∫–∏. –†–∞—Å—Å–º–æ—Ç—Ä–∏—Ç–µ –≤–Ω–∏–º–∞—Ç–µ–ª—å–Ω–æ.'
                };
            } else {
                return {
                    action: 'SELL',
                    class: 'recommendation-sell',
                    title: 'üî¥ –ù–ï –†–ï–ö–û–ú–ï–ù–î–£–ï–¢–°–Ø',
                    description: '–≠—Ç–æ—Ç –æ–ø—Ü–∏–æ–Ω –∏–º–µ–µ—Ç –≤—ã—Å–æ–∫–∏–π —Ä–∏—Å–∫ –∏ –Ω–∏–∑–∫–∏–π –ø–æ—Ç–µ–Ω—Ü–∏–∞–ª –ø—Ä–∏–±—ã–ª–∏.'
                };
            }
        }

        function getDetailedAnalysis(data) {
            const underlyingPrice = data.underlying_price;
            const strike = parseFloat(data.secid.match(/\d+\.?\d*/)[0]);
            const optionType = getOptionType(data);
            const daysToExpiry = data.days_until_expiring;
            const volatility = data.volatility;
            const theorPrice = data.theorprice;
            
            let pros = [];
            let cons = [];
            
            // –ê–Ω–∞–ª–∏–∑ –¥–µ–Ω–µ–∂–Ω–æ—Å—Ç–∏
            if (optionType === 'call') {
                const moneyness = (underlyingPrice - strike) / underlyingPrice;
                if (moneyness > 0.05) {
                    pros.push("–û–ø—Ü–∏–æ–Ω –≤ –¥–µ–Ω—å–≥–∞—Ö - —É–∂–µ –µ—Å—Ç—å –≤–Ω—É—Ç—Ä–µ–Ω–Ω—è—è —Å—Ç–æ–∏–º–æ—Å—Ç—å");
                    pros.push("–ú–µ–Ω—å—à–µ —Ä–∏—Å–∫–∞ –ø–æ—Ç–µ—Ä–∏ –≤—Å–µ–π –ø—Ä–µ–º–∏–∏");
                } else if (moneyness < -0.05) {
                    cons.push("–û–ø—Ü–∏–æ–Ω –¥–∞–ª–µ–∫–æ –æ—Ç –¥–µ–Ω–µ–≥ - –Ω—É–∂–µ–Ω —Å–∏–ª—å–Ω—ã–π —Ä–æ—Å—Ç");
                    cons.push("–í—ã—Å–æ–∫–∏–π —Ä–∏—Å–∫ –ø–æ—Ç–µ—Ä–∏ –≤—Å–µ–π –ø—Ä–µ–º–∏–∏");
                }
            }
            
            // –ê–Ω–∞–ª–∏–∑ –≤—Ä–µ–º–µ–Ω–∏
            if (daysToExpiry <= 7) {
                cons.push("–û—á–µ–Ω—å –º–∞–ª–æ –≤—Ä–µ–º–µ–Ω–∏ - –±—ã—Å—Ç—Ä–æ–µ –æ–±–µ—Å—Ü–µ–Ω–∏–≤–∞–Ω–∏–µ");
                cons.push("–í—ã—Å–æ–∫–∏–µ –≤—Ä–µ–º–µ–Ω–Ω—ã–µ –∏–∑–¥–µ—Ä–∂–∫–∏");
            } else if (daysToExpiry >= 30) {
                pros.push("–î–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –≤—Ä–µ–º–µ–Ω–∏ –¥–ª—è —Ä–∞–∑–≤–∏—Ç–∏—è –ø–æ–∑–∏—Ü–∏–∏");
                pros.push("–£–º–µ—Ä–µ–Ω–Ω—ã–µ –≤—Ä–µ–º–µ–Ω–Ω—ã–µ –∏–∑–¥–µ—Ä–∂–∫–∏");
            }
            
            // –ê–Ω–∞–ª–∏–∑ –≤–æ–ª–∞—Ç–∏–ª—å–Ω–æ—Å—Ç–∏
            if (volatility > 50) {
                cons.push("–í—ã—Å–æ–∫–∞—è –≤–æ–ª–∞—Ç–∏–ª—å–Ω–æ—Å—Ç—å - –¥–æ—Ä–æ–≥–∞—è –ø—Ä–µ–º–∏—è");
                cons.push("–°–ª–æ–∂–Ω–æ –ø—Ä–µ–¥—Å–∫–∞–∑–∞—Ç—å –¥–≤–∏–∂–µ–Ω–∏–µ");
            } else if (volatility < 30) {
                pros.push("–ù–∏–∑–∫–∞—è –≤–æ–ª–∞—Ç–∏–ª—å–Ω–æ—Å—Ç—å - –¥–µ—à–µ–≤–∞—è –ø—Ä–µ–º–∏—è");
                pros.push("–ë–æ–ª–µ–µ –ø—Ä–µ–¥—Å–∫–∞–∑—É–µ–º–æ–µ –¥–≤–∏–∂–µ–Ω–∏–µ");
            }
            
            // –ê–Ω–∞–ª–∏–∑ —Ü–µ–Ω—ã
            const priceRatio = theorPrice / underlyingPrice;
            if (priceRatio < 0.03) {
                pros.push("–û—á–µ–Ω—å –¥–µ—à–µ–≤—ã–π –æ–ø—Ü–∏–æ–Ω - –Ω–∏–∑–∫–∏–π —Ä–∏—Å–∫");
                pros.push("–í—ã—Å–æ–∫–∏–π –ø–æ—Ç–µ–Ω—Ü–∏–∞–ª –ø—Ä–∏–±—ã–ª–∏");
            } else if (priceRatio > 0.08) {
                cons.push("–î–æ—Ä–æ–≥–æ–π –æ–ø—Ü–∏–æ–Ω - –≤—ã—Å–æ–∫–∏–π —Ä–∏—Å–∫");
                cons.push("–ù—É–∂–µ–Ω —Å–∏–ª—å–Ω—ã–π —Ä–æ—Å—Ç –¥–ª—è –ø—Ä–∏–±—ã–ª–∏");
            }
            
            // –ê–Ω–∞–ª–∏–∑ –≥—Ä–µ–∫–æ–≤
            if (data.delta > 0.7) {
                pros.push("–í—ã—Å–æ–∫–∞—è —á—É–≤—Å—Ç–≤–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å –∫ –¥–≤–∏–∂–µ–Ω–∏—é —Ü–µ–Ω—ã");
            } else if (data.delta < 0.3) {
                cons.push("–ù–∏–∑–∫–∞—è —á—É–≤—Å—Ç–≤–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å –∫ –¥–≤–∏–∂–µ–Ω–∏—é —Ü–µ–Ω—ã");
            }
            
            if (data.theta > -0.01) {
                pros.push("–ú–µ–¥–ª–µ–Ω–Ω–æ–µ –≤—Ä–µ–º–µ–Ω–Ω–æ–µ –æ–±–µ—Å—Ü–µ–Ω–∏–≤–∞–Ω–∏–µ");
            } else {
                cons.push("–ë—ã—Å—Ç—Ä–æ–µ –≤—Ä–µ–º–µ–Ω–Ω–æ–µ –æ–±–µ—Å—Ü–µ–Ω–∏–≤–∞–Ω–∏–µ");
            }
            
            return { pros, cons };
        }

        function calculateBreakEven(data) {
            const strike = parseFloat(data.secid.match(/\d+\.?\d*/)[0]);
            const optionType = getOptionType(data);
            const theorPrice = data.theorprice;
            
            if (optionType === 'call') {
                return strike + theorPrice;
            } else {
                return strike - theorPrice;
            }
        }

        function calculateExpirationDate(daysToExpiry) {
            const today = new Date();
            const expirationDate = new Date(today);
            expirationDate.setDate(today.getDate() + daysToExpiry);
            
            return expirationDate.toLocaleDateString('ru-RU', {
                year: 'numeric',
                month: 'long',
                day: 'numeric',
                weekday: 'long'
            });
        }

        function calculateRecommendedPrice(data) {
            const theorPrice = data.theorprice;
            const underlyingPrice = data.underlying_price;
            
            // –†–µ–∫–æ–º–µ–Ω–¥—É–µ–º–∞—è —Ü–µ–Ω–∞ –ø–æ–∫—É–ø–∫–∏: —Ç–µ–æ—Ä–µ—Ç–∏—á–µ—Å–∫–∞—è —Ü–µ–Ω–∞ + –Ω–µ–±–æ–ª—å—à–æ–π —Å–ø—Ä–µ–¥
            // –î–ª—è –¥–µ—à–µ–≤—ã—Ö –æ–ø—Ü–∏–æ–Ω–æ–≤ —Å–ø—Ä–µ–¥ –º–µ–Ω—å—à–µ, –¥–ª—è –¥–æ—Ä–æ–≥–∏—Ö - –±–æ–ª—å—à–µ
            const priceRatio = theorPrice / underlyingPrice;
            let spread = 0;
            
            if (priceRatio < 0.01) {
                spread = 0.01; // 1 –∫–æ–ø–µ–π–∫–∞ –¥–ª—è –æ—á–µ–Ω—å –¥–µ—à–µ–≤—ã—Ö –æ–ø—Ü–∏–æ–Ω–æ–≤
            } else if (priceRatio < 0.05) {
                spread = theorPrice * 0.05; // 5% —Å–ø—Ä–µ–¥
            } else {
                spread = theorPrice * 0.03; // 3% —Å–ø—Ä–µ–¥ –¥–ª—è –¥–æ—Ä–æ–≥–∏—Ö –æ–ø—Ü–∏–æ–Ω–æ–≤
            }
            
            return theorPrice + spread;
        }

        async function analyzeAllOptions() {
            const assetCode = document.getElementById('assetCode').value.trim();
            const optionType = document.getElementById('optionType').value;
            const tradeType = document.getElementById('tradeType').value;
            
            if (!assetCode) {
                alert('–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –≤–≤–µ–¥–∏—Ç–µ –∫–æ–¥ –±–∞–∑–æ–≤–æ–≥–æ –∞–∫—Ç–∏–≤–∞');
                return;
            }
            
            // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –∑–∞–≥—Ä—É–∑–∫—É
            document.getElementById('results').innerHTML = `
                <div class="loading">
                    <div class="spinner"></div>
                    –ê–Ω–∞–ª–∏–∑–∏—Ä—É–µ–º –≤—Å–µ –æ–ø—Ü–∏–æ–Ω—ã –Ω–∞ ${assetCode}...
                </div>
            `;
            document.getElementById('results').style.display = 'block';
            document.getElementById('stats').style.display = 'none';
            
            // –ü–æ–ª—É—á–∞–µ–º —Å–ø–∏—Å–æ–∫ –≤—Å–µ—Ö –æ–ø—Ü–∏–æ–Ω–æ–≤
            const optionsUrl = `https://iss.moex.com/iss/apps/option-calc/v1/assets/${assetCode}/options`;
            const optionsResult = await makeRequest(optionsUrl);
            
            if (optionsResult.status !== 200) {
                document.getElementById('results').innerHTML = `
                    <h3>‚ùå –û—à–∏–±–∫–∞ –ø–æ–ª—É—á–µ–Ω–∏—è —Å–ø–∏—Å–∫–∞ –æ–ø—Ü–∏–æ–Ω–æ–≤</h3>
                    <p>–°—Ç–∞—Ç—É—Å: ${optionsResult.status}</p>
                    <p>–û—à–∏–±–∫–∞: ${optionsResult.data.error || '–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–∞—è –æ—à–∏–±–∫–∞'}</p>
                `;
                return;
            }
            
            // –§–∏–ª—å—Ç—Ä—É–µ–º –æ–ø—Ü–∏–æ–Ω—ã –ø–æ —Ç–∏–ø—É
            const filteredOptions = optionsResult.data.filter(option => {
                // –ò—Å–ø–æ–ª—å–∑—É–µ–º –ø–æ–ª–µ option_type –∏–∑ API –¥–ª—è —Ç–æ—á–Ω–æ–≥–æ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è
                const optionTypeFromAPI = option.option_type ? option.option_type.toLowerCase() : null;
                
                if (optionTypeFromAPI) {
                    console.log(`–û–ø—Ü–∏–æ–Ω ${option.secid}: —Ç–∏–ø –∏–∑ API=${optionTypeFromAPI}, –≤—ã–±—Ä–∞–Ω–Ω—ã–π —Ç–∏–ø=${optionType}`);
                    return optionTypeFromAPI === optionType;
                } else {
                    // Fallback: –æ–ø—Ä–µ–¥–µ–ª—è–µ–º –ø–æ SECID
                    const optionTypeFromSecid = getOptionType(option.secid);
                    console.log(`–û–ø—Ü–∏–æ–Ω ${option.secid}: —Ç–∏–ø –∏–∑ SECID=${optionTypeFromSecid}, –≤—ã–±—Ä–∞–Ω–Ω—ã–π —Ç–∏–ø=${optionType}`);
                    return optionTypeFromSecid === optionType;
                }
            });
            
            console.log(`–û—Ç—Ñ–∏–ª—å—Ç—Ä–æ–≤–∞–Ω–æ ${filteredOptions.length} –æ–ø—Ü–∏–æ–Ω–æ–≤ –∏–∑ ${optionsResult.data.length}`);
            console.log('–û—Ç—Ñ–∏–ª—å—Ç—Ä–æ–≤–∞–Ω–Ω—ã–µ –æ–ø—Ü–∏–æ–Ω—ã:', filteredOptions.map(o => o.secid));
            console.log('–í—Å–µ –æ–ø—Ü–∏–æ–Ω—ã:', optionsResult.data.map(o => o.secid));
            
            // –ê–Ω–∞–ª–∏–∑–∏—Ä—É–µ–º –∫–∞–∂–¥—ã–π –æ–ø—Ü–∏–æ–Ω
            allOptionsData = [];
            let processedCount = 0;
            
            for (const option of filteredOptions) {
                const detailUrl = `https://iss.moex.com/iss/apps/option-calc/v1/assets/${assetCode}/options/${option.secid}`;
                const detailResult = await makeRequest(detailUrl);
                
                if (detailResult.status === 200) {
                    const analysis = calculateProfitPotential(detailResult.data);
                    const recommendation = getTradeRecommendation(analysis.score);
                    
                    allOptionsData.push({
                        ...detailResult.data,
                        analysis: analysis,
                        recommendation: recommendation
                    });
                }
                
                processedCount++;
                // –û–±–Ω–æ–≤–ª—è–µ–º –ø—Ä–æ–≥—Ä–µ—Å—Å
                if (processedCount % 10 === 0) {
                    document.getElementById('results').innerHTML = `
                        <div class="loading">
                            <div class="spinner"></div>
                            –û–±—Ä–∞–±–æ—Ç–∞–Ω–æ ${processedCount} –∏–∑ ${filteredOptions.length} –æ–ø—Ü–∏–æ–Ω–æ–≤...
                        </div>
                    `;
                }
            }
            
            // –°–æ—Ä—Ç–∏—Ä—É–µ–º –ø–æ —Ä–µ–π—Ç–∏–Ω–≥—É (–ª—É—á—à–∏–π –ø–µ—Ä–≤—ã–π)
            allOptionsData.sort((a, b) => b.analysis.score - a.analysis.score);
            
            displayResults();
        }

        function displayResults() {
            const assetCode = document.getElementById('assetCode').value.trim();
            const optionType = document.getElementById('optionType').value;
            const tradeType = document.getElementById('tradeType').value;
            
            // –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞
            const totalOptions = allOptionsData.length;
            const excellentOptions = allOptionsData.filter(o => o.analysis.score >= 70).length;
            const goodOptions = allOptionsData.filter(o => o.analysis.score >= 50 && o.analysis.score < 70).length;
            const poorOptions = allOptionsData.filter(o => o.analysis.score < 50).length;
            
            let statsHtml = `
                <h3>üìä –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –∞–Ω–∞–ª–∏–∑–∞</h3>
                <div class="stats-grid">
                    <div class="stat-item">
                        <div class="stat-value">${totalOptions}</div>
                        <div class="stat-label">–í—Å–µ–≥–æ –æ–ø—Ü–∏–æ–Ω–æ–≤</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-value" style="color: #27ae60;">${excellentOptions}</div>
                        <div class="stat-label">–û—Ç–ª–∏—á–Ω—ã—Ö (70+)</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-value" style="color: #f39c12;">${goodOptions}</div>
                        <div class="stat-label">–•–æ—Ä–æ—à–∏—Ö (50-69)</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-value" style="color: #e74c3c;">${poorOptions}</div>
                        <div class="stat-label">–ü–ª–æ—Ö–∏—Ö (<50)</div>
                    </div>
                </div>
                <div class="info-box">
                    <strong>‚ö†Ô∏è –í–∞–∂–Ω–æ:</strong> –†–µ–π—Ç–∏–Ω–≥ –æ—Å–Ω–æ–≤–∞–Ω –Ω–∞ —Ç–µ–æ—Ä–µ—Ç–∏—á–µ—Å–∫–∏—Ö –ø–∞—Ä–∞–º–µ—Ç—Ä–∞—Ö. –ü–µ—Ä–µ–¥ –ø–æ–∫—É–ø–∫–æ–π –ø—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–∏–∫–≤–∏–¥–Ω–æ—Å—Ç—å –æ–ø—Ü–∏–æ–Ω–∞ –≤ —Ç–æ—Ä–≥–æ–≤–æ–º —Ç–µ—Ä–º–∏–Ω–∞–ª–µ!
                </div>
            `;
            
            document.getElementById('stats').innerHTML = statsHtml;
            document.getElementById('stats').style.display = 'block';
            
            // –°–ø–∏—Å–æ–∫ –æ–ø—Ü–∏–æ–Ω–æ–≤
            let resultsHtml = `
                <h3>üèÜ –†–µ–π—Ç–∏–Ω–≥ –æ–ø—Ü–∏–æ–Ω–æ–≤ ${assetCode} ${optionType.toUpperCase()} (${tradeType.toUpperCase()})</h3>
                <p style="color: #7f8c8d; margin-bottom: 20px;">
                    <strong>–§–∏–ª—å—Ç—Ä:</strong> ${optionType === 'call' ? 'CALL –æ–ø—Ü–∏–æ–Ω—ã (–ø–æ –ø–æ–ª—é option_type –∏–∑ API)' : 'PUT –æ–ø—Ü–∏–æ–Ω—ã (–ø–æ –ø–æ–ª—é option_type –∏–∑ API)'}
                </p>
                <div class="options-list">
            `;
            
            allOptionsData.forEach((option, index) => {
                const scoreClass = option.analysis.score >= 70 ? 'excellent' : 
                                 option.analysis.score >= 50 ? 'good' : 'poor';
                const scoreColorClass = option.analysis.score >= 70 ? 'score-excellent' : 
                                       option.analysis.score >= 50 ? 'score-good' : 'score-poor';
                const recommendationClass = option.recommendation.action === 'BUY' ? 'recommendation-buy' :
                                           option.recommendation.action === 'HOLD' ? 'recommendation-hold' : 'recommendation-sell';
                
                const breakEvenPrice = calculateBreakEven(option);
                const underlyingPrice = option.underlying_price;
                const strike = parseFloat(option.secid.match(/\d+\.?\d*/)[0]);
                
                resultsHtml += `
                    <div class="option-card ${scoreClass}" onclick="openModal(${index})">
                        <div class="option-header">
                            <div class="option-title">#${index + 1} ${option.secid}</div>
                            <div class="option-score ${scoreColorClass}">${option.analysis.score}/100</div>
                        </div>
                        
                        <div class="option-details">
                            <div class="detail-item">
                                <div class="detail-value">${strike}</div>
                                <div class="detail-label">–°—Ç—Ä–∞–π–∫</div>
                            </div>
                            <div class="detail-item">
                                <div class="detail-value">${option.theorprice.toFixed(2)}</div>
                                <div class="detail-label">–¶–µ–Ω–∞</div>
                            </div>
                            <div class="detail-item">
                                <div class="detail-value">${option.days_until_expiring}</div>
                                <div class="detail-label">–î–Ω–µ–π</div>
                            </div>
                            <div class="detail-item">
                                <div class="detail-value">${breakEvenPrice.toFixed(2)}</div>
                                <div class="detail-label">–ë–µ–∑—É–±—ã—Ç–æ–∫</div>
                            </div>
                            <div class="detail-item">
                                <div class="detail-value">${calculateExpirationDate(option.days_until_expiring).split(' ')[1]}</div>
                                <div class="detail-label">–ú–µ—Å—è—Ü</div>
                            </div>
                        </div>
                        
                        <div class="option-recommendation ${recommendationClass}">
                            ${option.recommendation.title}
                        </div>
                    </div>
                `;
            });
            
            resultsHtml += '</div>';
            document.getElementById('results').innerHTML = resultsHtml;
        }

        function openModal(index) {
            const option = allOptionsData[index];
            currentModalData = option;
            
            const detailedAnalysis = getDetailedAnalysis(option);
            const breakEvenPrice = calculateBreakEven(option);
            const recommendedPrice = calculateRecommendedPrice(option);
            const expirationDate = calculateExpirationDate(option.days_until_expiring);
            const underlyingPrice = option.underlying_price;
            const strike = parseFloat(option.secid.match(/\d+\.?\d*/)[0]);
            const optionType = getOptionType(option);
            
            console.log(`–ú–æ–¥–∞–ª–∫–∞ –¥–ª—è ${option.secid}: —Ç–∏–ø=${optionType} (–∏–∑ ${option.option_type ? 'API' : 'SECID'})`);
            
            let modalHtml = `
                <div class="modal-header">
                    <div class="modal-title">üéØ –î–µ—Ç–∞–ª—å–Ω—ã–π –∞–Ω–∞–ª–∏–∑: ${option.secid}</div>
                    <div class="modal-subtitle">–ü–æ–∑–∏—Ü–∏—è –≤ —Ä–µ–π—Ç–∏–Ω–≥–µ: #${index + 1} –∏–∑ ${allOptionsData.length}</div>
                </div>
                
                <div class="${option.recommendation.class}">
                    <h3>${option.recommendation.title}</h3>
                    <p><strong>${option.recommendation.description}</strong></p>
                </div>
                
                <div class="score-card">
                    <h3>üìä –û—Ü–µ–Ω–∫–∞ –ø–æ—Ç–µ–Ω—Ü–∏–∞–ª–∞: ${option.analysis.score}/100</h3>
                    <div class="score-bar">
                        <div class="score-fill ${option.analysis.score >= 70 ? 'score-excellent' : option.analysis.score >= 50 ? 'score-good' : 'score-poor'}" 
                             style="width: ${option.analysis.score}%"></div>
                    </div>
                    <p><strong>–û–±–æ—Å–Ω–æ–≤–∞–Ω–∏–µ:</strong></p>
                    <ul>
                        ${option.analysis.reasons.map(reason => `<li>${reason}</li>`).join('')}
                    </ul>
                </div>
                
                <div class="price-analysis">
                    <h3>üí∞ –ê–Ω–∞–ª–∏–∑ —Ü–µ–Ω</h3>
                    <div class="price-breakdown">
                        <div class="price-item">
                            <div class="price-value">${underlyingPrice}</div>
                            <div class="price-label">–¶–µ–Ω–∞ –±–∞–∑–æ–≤–æ–≥–æ –∞–∫—Ç–∏–≤–∞</div>
                        </div>
                        <div class="price-item">
                            <div class="price-value">${strike}</div>
                            <div class="price-label">–°—Ç—Ä–∞–π–∫ –æ–ø—Ü–∏–æ–Ω–∞</div>
                        </div>
                        <div class="price-item">
                            <div class="price-value">${option.theorprice.toFixed(2)}</div>
                            <div class="price-label">–¢–µ–æ—Ä–µ—Ç–∏—á–µ—Å–∫–∞—è —Ü–µ–Ω–∞</div>
                        </div>
                        <div class="price-item">
                            <div class="price-value">${recommendedPrice.toFixed(2)}</div>
                            <div class="price-label">–†–µ–∫–æ–º–µ–Ω–¥—É–µ–º–∞—è —Ü–µ–Ω–∞ –ø–æ–∫—É–ø–∫–∏</div>
                        </div>
                        <div class="price-item">
                            <div class="price-value">${breakEvenPrice.toFixed(2)}</div>
                            <div class="price-label">–¢–æ—á–∫–∞ –±–µ–∑—É–±—ã—Ç–æ—á–Ω–æ—Å—Ç–∏</div>
                        </div>
                    </div>
                    <p><strong>–î–ª—è –ø—Ä–∏–±—ã–ª–∏ ${optionType === 'call' ? '—Ü–µ–Ω–∞ –ë–ê –¥–æ–ª–∂–Ω–∞ –≤—ã—Ä–∞—Å—Ç–∏' : '—Ü–µ–Ω–∞ –ë–ê –¥–æ–ª–∂–Ω–∞ —É–ø–∞—Å—Ç—å'} –¥–æ ${breakEvenPrice.toFixed(2)}</strong></p>
                </div>
                
                <div class="pros-cons">
                    <div class="pros">
                        <h4>‚úÖ –ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞</h4>
                        <ul>
                            ${detailedAnalysis.pros.map(pro => `<li>${pro}</li>`).join('')}
                        </ul>
                    </div>
                    <div class="cons">
                        <h4>‚ùå –†–∏—Å–∫–∏</h4>
                        <ul>
                            ${detailedAnalysis.cons.map(con => `<li>${con}</li>`).join('')}
                        </ul>
                    </div>
                </div>
                
                <div class="analysis-section">
                    <h3>üìà –î–µ—Ç–∞–ª—å–Ω—ã–π –∞–Ω–∞–ª–∏–∑</h3>
                    <p><strong>–¢–∏–ø –æ–ø—Ü–∏–æ–Ω–∞:</strong> ${optionType.toUpperCase()}</p>
                    <p><strong>–î–∞—Ç–∞ –ø–æ–≥–∞—à–µ–Ω–∏—è:</strong> ${expirationDate}</p>
                    <p><strong>–î–Ω–µ–π –¥–æ —ç–∫—Å–ø–∏—Ä–∞—Ü–∏–∏:</strong> ${option.days_until_expiring}</p>
                    <p><strong>–í–æ–ª–∞—Ç–∏–ª—å–Ω–æ—Å—Ç—å:</strong> ${option.volatility}%</p>
                    <p><strong>–ö–æ–º–∏—Å—Å–∏—è:</strong> ${option.fee}</p>
                    
                    <h4>–†–∏—Å–∫-–ø–∞—Ä–∞–º–µ—Ç—Ä—ã:</h4>
                    <p><strong>Delta:</strong> ${option.delta.toFixed(4)} - —á—É–≤—Å—Ç–≤–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å –∫ —Ü–µ–Ω–µ –ë–ê</p>
                    <p><strong>Gamma:</strong> ${option.gamma.toFixed(6)} - —Å–∫–æ—Ä–æ—Å—Ç—å –∏–∑–º–µ–Ω–µ–Ω–∏—è Delta</p>
                    <p><strong>Theta:</strong> ${option.theta.toFixed(6)} - –≤—Ä–µ–º–µ–Ω–Ω–æ–µ –æ–±–µ—Å—Ü–µ–Ω–∏–≤–∞–Ω–∏–µ</p>
                    <p><strong>Vega:</strong> ${option.vega.toFixed(2)} - —á—É–≤—Å—Ç–≤–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å –∫ –≤–æ–ª–∞—Ç–∏–ª—å–Ω–æ—Å—Ç–∏</p>
                </div>
            `;
            
            document.getElementById('modalContent').innerHTML = modalHtml;
            document.getElementById('optionModal').style.display = 'block';
        }

        function closeModal() {
            document.getElementById('optionModal').style.display = 'none';
        }

        // –ó–∞–∫—Ä—ã—Ç–∏–µ –º–æ–¥–∞–ª–∫–∏ –ø—Ä–∏ –∫–ª–∏–∫–µ –≤–Ω–µ –µ—ë
        window.onclick = function(event) {
            const modal = document.getElementById('optionModal');
            if (event.target === modal) {
                closeModal();
            }
        }
    </script>
</body>
</html> 